<!DOCTYPE html>
<!--
  ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
  ‚ïë         BARTLETT'S ORDER MANAGEMENT SYSTEM                   ‚ïë
  ‚ïë                                                              ‚ïë
  ‚ïë  ¬© 2025 Oscar Rivas. All rights reserved.                    ‚ïë
  ‚ïë  Bartlett's Restaurant ‚Äî Austin, TX                          ‚ïë
  ‚ïë                                                              ‚ïë
  ‚ïë  This software is the proprietary property of Oscar Rivas.   ‚ïë
  ‚ïë  Unauthorized copying, distribution, modification, or use    ‚ïë
  ‚ïë  of this application, in whole or in part, without the       ‚ïë
  ‚ïë  express written permission of Oscar Rivas is strictly       ‚ïë
  ‚ïë  prohibited.                                                  ‚ïë
  ‚ïë                                                              ‚ïë
  ‚ïë  Designed & built for Bartlett's Restaurant operations.      ‚ïë
  ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
-->
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">

  <!-- PWA / iOS home screen meta -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Bartlett's">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#000000">
  <meta name="application-name" content="Bartlett's Orders">
  <meta name="description" content="Bartlett's Restaurant Order Management">

  <!-- Icons (embedded as base64 ‚Äî no server needed) -->
  <link rel="apple-touch-icon" href="data:image/png;base64,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">
  <link rel="icon" type="image/png" sizes="192x192" href="data:image/png;base64,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">
  <link rel="icon" type="image/png" sizes="512x512" href="data:image/png;base64,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">

  <!-- Inline PWA manifest as data URI (works without a server) -->
  <link rel="manifest" href="data:application/json,%7B%22name%22%3A%22Bartlett's%20Order%20Management%22%2C%22short_name%22%3A%22Bartlett's%22%2C%22start_url%22%3A%22.%22%2C%22display%22%3A%22standalone%22%2C%22background_color%22%3A%22%23000000%22%2C%22theme_color%22%3A%22%23000000%22%2C%22orientation%22%3A%22portrait-primary%22%7D">

  <title>Bartlett's ¬∑ Order Management</title>

  <style>
    /* System fonts ‚Äî no internet needed, native on every Apple device */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html { -webkit-text-size-adjust: 100%; text-size-adjust: 100%; height: 100%; }
    body {
      background: #000;
      overflow: hidden;
      height: 100%;
      font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'SF Pro Text', 'Helvetica Neue', Arial, sans-serif;
      color: #f2f2f7;
      -webkit-tap-highlight-color: transparent;
      overscroll-behavior: none;
      -webkit-overflow-scrolling: auto;
    }
    ::-webkit-scrollbar { display: none; }
    input, textarea, button, select {
      -webkit-appearance: none; appearance: none; outline: none;
      font-family: inherit;
    }
    input[type=number] { -moz-appearance: textfield; }
    input[type=number]::-webkit-inner-spin-button,
    input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
    button { cursor: pointer; }

    /* Install banner */
    #install-banner {
      position: fixed; top: 0; left: 0; right: 0; z-index: 9999;
      background: #14532d;
      padding: 12px 16px;
      padding-top: calc(12px + env(safe-area-inset-top, 0px));
      display: flex; align-items: center; gap: 12px;
      font-family: ui-monospace, 'SF Mono', 'Courier New', monospace;
      box-shadow: 0 4px 20px rgba(0,0,0,0.6);
      transform: translateY(-100%);
      transition: transform 0.35s ease;
    }
    #install-banner.show { transform: translateY(0); }
    #install-banner .ib-icon {
      width: 44px; height: 44px; border-radius: 10px; flex-shrink: 0;
      background: #0a0a0a; display: flex; align-items: center; justify-content: center;
      font-size: 24px;
    }
    #install-banner .ib-text { flex: 1; }
    #install-banner .ib-title { color: #4ade80; font-size: 12px; font-weight: 700; letter-spacing: 0.5px; }
    #install-banner .ib-sub { color: rgba(255,255,255,0.55); font-size: 10px; margin-top: 2px; line-height: 1.4; }
    #install-banner .ib-close {
      width: 32px; height: 32px; border-radius: 16px; border: none;
      background: rgba(0,0,0,0.3); color: #4ade80; font-size: 18px;
      display: flex; align-items: center; justify-content: center; flex-shrink: 0;
    }

    #app {
      height: 100vh;
      height: 100dvh;
      display: flex;
      flex-direction: column;
      background: #000;
      overflow: hidden;
      padding-top: env(safe-area-inset-top, 0px);
    }

    /* Top bar */
    #topbar {
      background: #111; border-bottom: 1px solid #1c1c1e;
      padding: 0 16px; height: 52px;
      display: flex; align-items: center; justify-content: space-between;
      flex-shrink: 0;
    }
    .brand-name { font-family: ui-monospace, 'SF Mono', 'Courier New', monospace; font-weight: 700; font-size: 14px; color: #ef4444; letter-spacing: 1px; }
    .brand-sub  { font-family: ui-monospace, 'SF Mono', 'Courier New', monospace; font-size: 9px; color: #2c2c2e; letter-spacing: 2px; }
    .topbar-right { display: flex; align-items: center; gap: 8px; }
    .date-chip { color: #3a3a3c; font-family: ui-monospace, 'SF Mono', 'Courier New', monospace; font-size: 10px; }

    .btn-edit {
      height: 40px; padding: 0 14px; border-radius: 20px;
      border: 2px solid #2c2c2e; background: transparent; color: #636366;
      font-family: ui-monospace, 'SF Mono', 'Courier New', monospace; font-size: 11px; font-weight: 700;
      display: flex; align-items: center; gap: 5px; transition: all 0.15s;
    }
    .btn-edit.active { border-color: #fbbf24; background: rgba(251,191,36,0.12); color: #fbbf24; }

    .btn-save {
      height: 40px; padding: 0 16px; border-radius: 20px; border: none;
      background: #4ade80; color: #000;
      font-family: ui-monospace, 'SF Mono', 'Courier New', monospace; font-size: 12px; font-weight: 800;
      display: flex; align-items: center; gap: 5px;
    }
    .btn-save:active { transform: scale(0.97); }

    /* Content area */
    #content { flex: 1; overflow: hidden; display: flex; flex-direction: column; }

    /* Supplier tab bar */
    .sup-tabs {
      display: flex; overflow-x: auto; gap: 8px; padding: 10px 16px;
      background: #000; -webkit-overflow-scrolling: touch;
      scrollbar-width: none; flex-shrink: 0;
    }
    .sup-tab {
      flex-shrink: 0; height: 44px; padding: 0 18px; border-radius: 22px;
      border: 2px solid #2c2c2e; background: #1c1c1e; color: #636366;
      font-family: ui-monospace, 'SF Mono', 'Courier New', monospace; font-size: 11px; font-weight: 700;
      letter-spacing: 0.5px; white-space: nowrap;
      display: flex; align-items: center; gap: 7px; transition: all 0.15s;
    }
    .sup-tab.active { color: #fff; }
    .sup-tab-badge {
      border-radius: 99px; min-width: 18px; height: 18px; padding: 0 4px;
      font-size: 10px; font-weight: 800;
      display: flex; align-items: center; justify-content: center;
    }

    /* Supplier info strip */
    .sup-info { padding: 8px 16px; flex-shrink: 0; }
    .sup-info-sched { color: #fff; font-family: ui-monospace, 'SF Mono', 'Courier New', monospace; font-size: 11px; }
    .sup-info-contact { color: rgba(255,255,255,0.5); font-family: ui-monospace, 'SF Mono', 'Courier New', monospace; font-size: 10px; margin-top: 1px; }
    .sup-info-alerts { margin-top: 4px; display: flex; gap: 12px; }

    /* Edit mode banner */
    .edit-banner {
      background: #1a1a00; border-bottom: 2px solid #fbbf24;
      padding: 10px 16px; display: flex; align-items: center; justify-content: space-between;
      flex-shrink: 0;
    }
    .edit-banner-title { color: #fbbf24; font-family: ui-monospace, 'SF Mono', 'Courier New', monospace; font-size: 12px; font-weight: 700; }
    .edit-banner-sub { color: #78716c; font-family: ui-monospace, 'SF Mono', 'Courier New', monospace; font-size: 10px; margin-top: 1px; }
    .btn-done-edit {
      height: 36px; padding: 0 14px; border-radius: 18px;
      border: 2px solid #fbbf24; background: transparent; color: #fbbf24;
      font-family: ui-monospace, 'SF Mono', 'Courier New', monospace; font-size: 11px; font-weight: 700;
    }

    /* Item list */
    #item-list { flex: 1; overflow-y: auto; -webkit-overflow-scrolling: touch; }

    .item-row {
      border-bottom: 1px solid #1c1c1e;
      display: flex; flex-direction: column;
    }
    .item-row-inner {
      display: flex; align-items: center; gap: 10px;
      padding: 11px 16px; min-height: 64px;
    }
    .item-name { color: #f2f2f7; font-size: 15px; font-weight: 500; line-height: 1.3; }
    .item-meta { color: #48484a; font-size: 12px; font-family: ui-monospace, 'SF Mono', 'Courier New', monospace; margin-top: 2px; display: flex; gap: 8px; }
    .item-par-edit { color: #fbbf24; }

    .inp-col { display: flex; flex-direction: column; align-items: center; gap: 2px; }
    .inp-label { color: #48484a; font-size: 9px; font-family: ui-monospace, 'SF Mono', 'Courier New', monospace; letter-spacing: 0.8px; }
    .inp-field {
      width: 58px; height: 44px; background: #1c1c1e;
      border: 2px solid #2c2c2e; border-radius: 12px;
      color: #fff; text-align: center;
      font-family: ui-monospace, 'SF Mono', 'Courier New', monospace; font-size: 17px;
    }
    .inp-field:focus { outline: none; }

    .note-btn {
      width: 34px; height: 34px; border-radius: 10px; border: none;
      background: #2c2c2e; color: #555; font-size: 16px;
      display: flex; align-items: center; justify-content: center;
    }
    .note-btn.has-note { background: rgba(251,191,36,0.18); color: #fbbf24; }

    .edit-item-btn {
      width: 36px; height: 36px; border-radius: 10px;
      border: 2px solid #4ade80; background: rgba(74,222,128,0.1);
      color: #4ade80; font-size: 15px; flex-shrink: 0;
      display: flex; align-items: center; justify-content: center;
    }

    .note-drawer { padding: 0 16px 12px; }
    .note-textarea {
      width: 100%; background: #1c1c1e; border: 1.5px solid #3a3a3c;
      border-radius: 12px; color: #f2f2f7; padding: 10px 12px;
      font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', 'Helvetica Neue', Arial, sans-serif; font-size: 15px;
      resize: none; box-sizing: border-box;
    }

    /* Global notes area */
    .global-notes-area { padding: 20px 16px 8px; }
    .section-label {
      color: #636366; font-family: ui-monospace, 'SF Mono', 'Courier New', monospace;
      font-size: 11px; letter-spacing: 1px; margin-bottom: 8px;
      display: flex; align-items: center; gap: 6px;
    }
    .global-textarea {
      width: 100%; background: #1c1c1e; border: 2px solid #2c2c2e;
      border-radius: 14px; color: #f2f2f7;
      padding: 14px; font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', 'Helvetica Neue', Arial, sans-serif; font-size: 16px;
      resize: none; box-sizing: border-box; line-height: 1.5;
    }
    .global-textarea.has-content { border-color: #fbbf24; }

    /* Bottom tab bar */
    #tabbar {
      background: #111; border-top: 1px solid #1c1c1e;
      display: flex; flex-shrink: 0;
      padding-bottom: env(safe-area-inset-bottom, 0px);
    }
    .tab-btn {
      flex: 1; height: 56px; border: none; background: transparent;
      display: flex; flex-direction: column; align-items: center;
      justify-content: center; gap: 2px; color: #636366; position: relative;
      font-family: ui-monospace, 'SF Mono', 'Courier New', monospace;
    }
    .tab-btn.active { color: #4ade80; }
    .tab-btn .tab-emoji { font-size: 22px; line-height: 1; }
    .tab-btn .tab-label { font-size: 10px; font-weight: 700; letter-spacing: 0.5px; }
    .tab-indicator {
      position: absolute; top: 0; left: 50%; transform: translateX(-50%);
      width: 32px; height: 2px; background: #4ade80; border-radius: 1px;
    }

    /* History */
    .filter-chips {
      display: flex; overflow-x: auto; gap: 8px; padding: 10px 16px;
      background: #000; -webkit-overflow-scrolling: touch;
      scrollbar-width: none; flex-shrink: 0;
    }
    .chip {
      flex-shrink: 0; height: 36px; padding: 0 14px; border-radius: 18px;
      border: 2px solid #2c2c2e; background: #1c1c1e; color: #636366;
      font-family: ui-monospace, 'SF Mono', 'Courier New', monospace; font-size: 11px; font-weight: 700; white-space: nowrap;
    }
    .chip.active { border-color: #4ade80; background: #14532d; color: #4ade80; }

    #history-list { flex: 1; overflow-y: auto; -webkit-overflow-scrolling: touch; }

    .hist-row {
      border-bottom: 1px solid #1c1c1e; display: flex; align-items: center;
    }
    .hist-row-btn {
      flex: 1; text-align: left; background: transparent; border: none;
      padding: 14px 16px; display: flex; align-items: center; gap: 14px; min-height: 72px;
    }
    .hist-date-tile {
      width: 50px; height: 56px; background: #1c1c1e; border-radius: 14px;
      display: flex; flex-direction: column; align-items: center;
      justify-content: center; flex-shrink: 0;
    }
    .hist-print-btn {
      width: 50px; height: 72px; border: none; border-left: 1px solid #1c1c1e;
      background: transparent; color: #4ade80; font-size: 20px;
      display: flex; flex-direction: column; align-items: center;
      justify-content: center; gap: 3px; flex-shrink: 0;
    }
    .hist-print-label { font-size: 8px; font-family: ui-monospace, 'SF Mono', 'Courier New', monospace; color: #3a3a3c; }

    /* History detail */
    #hist-detail { flex: 1; display: flex; flex-direction: column; overflow: hidden; display: none; }
    #hist-detail.show { display: flex; }
    .detail-header {
      background: #111; padding: 12px 16px; flex-shrink: 0;
      display: flex; align-items: center; gap: 12px;
      border-bottom: 1px solid #1c1c1e;
    }
    .btn-back {
      width: 44px; height: 44px; border-radius: 22px; border: none;
      background: #2c2c2e; color: #4ade80; font-size: 22px;
      display: flex; align-items: center; justify-content: center;
    }
    .btn-print-detail {
      height: 40px; padding: 0 14px; border-radius: 20px;
      border: 1.5px solid #4ade80; background: transparent; color: #4ade80;
      font-family: ui-monospace, 'SF Mono', 'Courier New', monospace; font-size: 11px; font-weight: 700;
      display: flex; align-items: center; gap: 6px;
    }
    #detail-scroll { flex: 1; overflow-y: auto; -webkit-overflow-scrolling: touch; }

    /* Modals / sheets */
    .sheet-overlay {
      position: fixed; inset: 0; z-index: 100;
      background: rgba(0,0,0,0.72);
      display: flex; align-items: flex-end;
      -webkit-backdrop-filter: blur(6px); backdrop-filter: blur(6px);
    }
    .sheet {
      width: 100%; background: #1c1c1e;
      border-radius: 20px 20px 0 0;
      padding: 8px 20px 0;
      padding-bottom: calc(24px + env(safe-area-inset-bottom, 0px));
    }
    .sheet-handle {
      width: 36px; height: 4px; background: #3a3a3c; border-radius: 2px;
      margin: 0 auto 20px;
    }
    .sheet-title { color: #f2f2f7; font-family: ui-monospace, 'SF Mono', 'Courier New', monospace; font-size: 17px; font-weight: 800; margin-bottom: 8px; }
    .sheet-sub { color: #8e8e93; font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', 'Helvetica Neue', Arial, sans-serif; font-size: 15px; line-height: 1.55; margin-bottom: 24px; }
    .btn-confirm {
      width: 100%; height: 56px; border-radius: 16px; border: none;
      background: #4ade80; color: #000;
      font-family: ui-monospace, 'SF Mono', 'Courier New', monospace; font-size: 16px; font-weight: 800; letter-spacing: 0.8px;
    }
    .btn-confirm:active { transform: scale(0.98); }
    .btn-cancel {
      width: 100%; height: 50px; border-radius: 16px; border: none;
      background: transparent; color: #8e8e93;
      font-family: ui-monospace, 'SF Mono', 'Courier New', monospace; font-size: 15px; font-weight: 600;
      margin-top: 6px;
    }

    /* Edit item sheet specific */
    .edit-field-label { color: #636366; font-family: ui-monospace, 'SF Mono', 'Courier New', monospace; font-size: 10px; letter-spacing: 1px; margin-bottom: 6px; }
    .edit-field-wrap { margin-bottom: 14px; }
    .edit-input {
      width: 100%; background: #2c2c2e; border: 2px solid #4ade80;
      border-radius: 12px; color: #f2f2f7; padding: 12px 14px;
      font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', 'Helvetica Neue', Arial, sans-serif; font-size: 16px; box-sizing: border-box;
    }
    .edit-input[type=number] { font-family: ui-monospace, 'SF Mono', 'Courier New', monospace; }

    /* Toast */
    #toast {
      position: fixed;
      bottom: calc(72px + env(safe-area-inset-bottom, 0px) + 12px);
      left: 50%; transform: translateX(-50%) translateY(12px);
      border-radius: 30px; padding: 12px 24px;
      font-family: ui-monospace, 'SF Mono', 'Courier New', monospace; font-size: 13px; font-weight: 700;
      z-index: 500; white-space: nowrap; pointer-events: none;
      box-shadow: 0 8px 40px rgba(0,0,0,0.7);
      opacity: 0; transition: opacity 0.2s, transform 0.2s;
      background: #14532d; color: #fff;
    }
    #toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }
    #toast.warn { background: #78350f; }
    #toast.error { background: #7f1d1d; }

    /* Empty state */
    .empty-state { padding: 48px; text-align: center; }
    .empty-icon { font-size: 40px; margin-bottom: 12px; }
    .empty-text { color: #3a3a3c; font-family: ui-monospace, 'SF Mono', 'Courier New', monospace; font-size: 13px; }

    /* Safe area spacer */
    .safe-bottom { height: env(safe-area-inset-bottom, 16px); min-height: 16px; }

    /* Detail supplier block */
    .detail-sup-header {
      padding: 9px 16px; display: flex; justify-content: space-between; align-items: center;
    }
    .detail-item {
      padding: 11px 16px; border-bottom: 1px solid #1c1c1e;
    }
    .detail-item.critical { background: rgba(248,113,113,0.08); }
    .detail-item.low { background: rgba(251,191,36,0.06); }
    .detail-item.alt { background: #111; }
    .detail-values { display: flex; align-items: center; gap: 10px; flex-shrink: 0; }
    .detail-val-col { text-align: center; }
    .detail-val-label { color: #48484a; font-size: 9px; font-family: ui-monospace, 'SF Mono', 'Courier New', monospace; }
    .detail-val { color: #aeaeb2; font-family: ui-monospace, 'SF Mono', 'Courier New', monospace; font-size: 15px; font-weight: 600; }
    .detail-val.ordered { color: #f97316; font-weight: 700; }
    .detail-val.empty { color: #3a3a3c; }
    .item-note-box {
      margin-top: 8px; background: rgba(251,191,36,0.09);
      border-radius: 8px; padding: 7px 10px;
      color: #d4a000; font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', 'Helvetica Neue', Arial, sans-serif; font-size: 13px; font-style: italic;
    }

    /* Supplier badge */
    .sup-badge {
      border-radius: 6px; padding: 2px 7px;
      font-size: 10px; font-family: ui-monospace, 'SF Mono', 'Courier New', monospace; font-weight: 700; color: #fff;
    }
  </style>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js" crossorigin="anonymous"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js" crossorigin="anonymous"></script>
</head>
<body>

<!-- PIN Lock Screen -->
<div id="pin-screen" style="
  position:fixed;inset:0;background:#000;z-index:99999;
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  font-family:ui-monospace,'SF Mono','Courier New',monospace;
  padding:env(safe-area-inset-top,0) env(safe-area-inset-right,0) env(safe-area-inset-bottom,0) env(safe-area-inset-left,0);
">
  <div style="color:#ef4444;font-size:22px;font-weight:800;letter-spacing:2px;margin-bottom:4px;">BARTLETT'S</div>
  <div style="color:#3a3a3c;font-size:10px;letter-spacing:2px;margin-bottom:40px;">ORDER MANAGEMENT</div>

  <div style="color:#636366;font-size:12px;letter-spacing:1px;margin-bottom:20px;">ENTER PIN</div>

  <!-- Dots -->
  <div id="pin-dots" style="display:flex;gap:16px;margin-bottom:36px;">
    <div class="pin-dot"></div>
    <div class="pin-dot"></div>
    <div class="pin-dot"></div>
    <div class="pin-dot"></div>
  </div>

  <!-- Error msg -->
  <div id="pin-error" style="color:#f87171;font-size:11px;letter-spacing:1px;height:16px;margin-bottom:16px;"></div>

  <!-- Keypad -->
  <div style="display:grid;grid-template-columns:repeat(3,72px);grid-template-rows:repeat(4,64px);gap:12px;">
    <button class="pin-key" onclick="pinPress('1')">1</button>
    <button class="pin-key" onclick="pinPress('2')">2</button>
    <button class="pin-key" onclick="pinPress('3')">3</button>
    <button class="pin-key" onclick="pinPress('4')">4</button>
    <button class="pin-key" onclick="pinPress('5')">5</button>
    <button class="pin-key" onclick="pinPress('6')">6</button>
    <button class="pin-key" onclick="pinPress('7')">7</button>
    <button class="pin-key" onclick="pinPress('8')">8</button>
    <button class="pin-key" onclick="pinPress('9')">9</button>
    <div></div>
    <button class="pin-key" onclick="pinPress('0')">0</button>
    <button class="pin-key pin-del" onclick="pinDel()">‚å´</button>
  </div>

  <div style="color:#2c2c2e;font-size:9px;letter-spacing:1px;margin-top:40px;">¬© 2025 OSCAR RIVAS ¬∑ BARTLETT'S RESTAURANT</div>
</div>

<style>
  .pin-dot {
    width:14px;height:14px;border-radius:50%;
    border:2px solid #3a3a3c;background:transparent;
    transition:background 0.15s;
  }
  .pin-dot.filled { background:#ef4444;border-color:#ef4444; }
  .pin-key {
    width:72px;height:64px;border-radius:16px;
    border:1.5px solid #2c2c2e;background:#1c1c1e;
    color:#f2f2f7;font-family:ui-monospace,'SF Mono','Courier New',monospace;
    font-size:22px;font-weight:600;cursor:pointer;
    transition:background 0.1s, transform 0.08s;
    -webkit-tap-highlight-color:transparent;
  }
  .pin-key:active { background:#2c2c2e;transform:scale(0.94); }
  .pin-del { font-size:18px;color:#636366; }
</style>
<div id="install-banner">
  <div class="ib-icon">üçÉ</div>
  <div class="ib-text">
    <div class="ib-title">INSTALL AS APP</div>
    <div class="ib-sub">Tap <strong>Share ‚Üë</strong> then <strong>"Add to Home Screen"</strong> for the full native experience</div>
  </div>
  <button class="ib-close" onclick="dismissInstall()">‚úï</button>
</div>

<div id="app">

  <!-- Top Bar -->
  <div id="topbar">
    <div>
      <div class="brand-name">BARTLETT'S</div>
      <div class="brand-sub">ORDER MANAGEMENT</div>
      <div style="font-family:ui-monospace,'SF Mono','Courier New',monospace;font-size:8px;color:#1c1c1e;letter-spacing:0.5px;margin-top:1px;">¬© 2025 Oscar Rivas</div>
    </div>
    <div class="topbar-right">
      <span class="date-chip" id="today-date"></span>
      <span id="sync-badge" title="Sync status" style="font-size:14px;cursor:default;">üìµ</span>
      <button class="btn-edit" id="btn-edit" onclick="toggleEditMode()">‚úé Edit</button>
      <button class="btn-save" id="btn-save" onclick="openSaveModal()">üíæ SAVE</button>
    </div>
  </div>

  <!-- Content -->
  <div id="content">

    <!-- ORDER VIEW -->
    <div id="view-order" style="flex:1;display:flex;flex-direction:column;overflow:hidden;">
      <div class="sup-tabs" id="sup-tabs"></div>
      <div class="sup-info" id="sup-info"></div>
      <div class="edit-banner" id="edit-banner" style="display:none;">
        <div>
          <div class="edit-banner-title">CATALOG EDIT MODE</div>
          <div class="edit-banner-sub">Tap any item to edit name, pack size, or par</div>
        </div>
        <button class="btn-done-edit" onclick="toggleEditMode()">‚úì Done Editing</button>
      </div>
      <div id="item-list"></div>
    </div>

    <!-- HISTORY VIEW -->
    <div id="view-history" style="flex:1;display:none;flex-direction:column;overflow:hidden;">
      <div class="filter-chips" id="filter-chips"></div>
      <div id="history-list"></div>
    </div>

    <!-- MUST KNOW VIEW -->
    <div id="view-mustknow" style="flex:1;display:none;flex-direction:column;overflow:hidden;">
      <div id="mustknow-scroll" style="flex:1;overflow-y:auto;-webkit-overflow-scrolling:touch;"></div>
    </div>

  </div>

  <!-- Copyright Footer -->
  <div style="background:#000;padding:3px 16px;text-align:center;flex-shrink:0;border-top:1px solid #111;">
    <span style="font-family:ui-monospace,'SF Mono','Courier New',monospace;font-size:7px;color:#2c2c2e;letter-spacing:0.8px;">
      ¬© 2025 OSCAR RIVAS ¬∑ BARTLETT'S RESTAURANT ¬∑ ALL RIGHTS RESERVED
    </span>
  </div>

  <!-- Tab Bar -->
  <div id="tabbar">
    <button class="tab-btn active" id="tab-order" onclick="switchTab('order')">
      <div class="tab-indicator"></div>
      <span class="tab-emoji">üìã</span>
      <span class="tab-label">Order</span>
    </button>
    <button class="tab-btn" id="tab-history" onclick="switchTab('history')">
      <span class="tab-emoji">üïê</span>
      <span class="tab-label">History</span>
    </button>
    <button class="tab-btn" id="tab-mustknow" onclick="switchTab('mustknow')">
      <span class="tab-emoji">üìå</span>
      <span class="tab-label">Must Know</span>
    </button>
  </div>

</div>

<!-- History Detail (full-screen overlay) -->
<div id="hist-detail">
  <div class="detail-header">
    <button class="btn-back" onclick="closeDetail()">‚Äπ</button>
    <div style="flex:1">
      <div id="detail-date" style="color:#f2f2f7;font-family:ui-monospace,'SF Mono','Courier New',monospace;font-size:13px;font-weight:700;"></div>
      <div id="detail-meta" style="color:#636366;font-family:ui-monospace,'SF Mono','Courier New',monospace;font-size:11px;margin-top:1px;"></div>
    </div>
    <button class="btn-print-detail" id="btn-print-detail">üñ® Print</button>
  </div>
  <div id="detail-scroll"></div>
</div>

<!-- Save Modal -->
<div class="sheet-overlay" id="save-modal" style="display:none;" onclick="closeSaveModal()">
  <div class="sheet" onclick="event.stopPropagation()">
    <div class="sheet-handle"></div>
    <div class="sheet-title">Save & Reset Order</div>
    <div class="sheet-sub">This saves everything to history and clears the sheet for the next order. All fields will be reset.</div>
    <button class="btn-confirm" id="btn-confirm-save" onclick="doSave()">‚úì  CONFIRM SAVE & RESET</button>
    <button class="btn-cancel" onclick="closeSaveModal()">Cancel</button>
  </div>
</div>

<!-- Edit Item Sheet -->
<div class="sheet-overlay" id="edit-sheet" style="display:none;" onclick="cancelEdit()">
  <div class="sheet" onclick="event.stopPropagation()">
    <div class="sheet-handle"></div>
    <div class="sheet-title">Edit Item</div>
    <div id="edit-sheet-sup" style="color:#636366;font-family:ui-monospace,'SF Mono','Courier New',monospace;font-size:10px;letter-spacing:1px;margin-bottom:18px;"></div>
    <div class="edit-field-wrap">
      <div class="edit-field-label">ITEM NAME</div>
      <input class="edit-input" type="text" id="edit-name" autocomplete="off" autocorrect="off" spellcheck="false">
    </div>
    <div class="edit-field-wrap">
      <div class="edit-field-label">PACK / CASE SIZE</div>
      <input class="edit-input" type="text" id="edit-pack" autocomplete="off">
    </div>
    <div class="edit-field-wrap" style="margin-bottom:22px;">
      <div class="edit-field-label">PAR LEVEL</div>
      <input class="edit-input" type="number" inputmode="decimal" id="edit-par">
    </div>
    <button class="btn-confirm" onclick="commitEdit()">‚úì  SAVE CHANGES</button>
    <button class="btn-cancel" onclick="cancelEdit()">Cancel</button>
  </div>
</div>

<!-- Location Tally Modal -->
<div class="sheet-overlay" id="tally-modal" style="display:none;" onclick="closeTallyModal()">
  <div class="sheet" onclick="event.stopPropagation()" style="padding-bottom:max(24px,env(safe-area-inset-bottom));">
    <div class="sheet-handle"></div>
    <div id="tally-item-name" style="font-size:15px;font-weight:700;color:#e5e5e7;margin-bottom:2px;"></div>
    <div id="tally-item-sub" style="font-family:ui-monospace,'SF Mono','Courier New',monospace;font-size:10px;color:#636366;letter-spacing:1px;margin-bottom:20px;"></div>

    <!-- Location rows -->
    <div style="display:flex;flex-direction:column;gap:12px;margin-bottom:20px;">
      <div style="display:flex;align-items:center;justify-content:space-between;">
        <div>
          <div style="font-family:ui-monospace,'SF Mono','Courier New',monospace;font-size:12px;font-weight:700;color:#c084fc;letter-spacing:1px;">üö¢ DOCK</div>
          <div style="font-family:ui-monospace,'SF Mono','Courier New',monospace;font-size:10px;color:#48484a;margin-top:2px;">Receiving area</div>
        </div>
        <input id="tally-dock" type="number" inputmode="decimal" placeholder="0"
          style="width:80px;height:46px;text-align:center;border-radius:10px;border:2px solid #3b0764;background:#1c1c1e;color:#c084fc;font-family:ui-monospace,'SF Mono','Courier New',monospace;font-size:22px;font-weight:700;-webkit-appearance:none;appearance:none;outline:none;">
      </div>
      <div style="display:flex;align-items:center;justify-content:space-between;">
        <div>
          <div style="font-family:ui-monospace,'SF Mono','Courier New',monospace;font-size:12px;font-weight:700;color:#c084fc;letter-spacing:1px;">üö™ CLOSET</div>
          <div style="font-family:ui-monospace,'SF Mono','Courier New',monospace;font-size:10px;color:#48484a;margin-top:2px;">Storage area</div>
        </div>
        <input id="tally-closet" type="number" inputmode="decimal" placeholder="0"
          style="width:80px;height:46px;text-align:center;border-radius:10px;border:2px solid #3b0764;background:#1c1c1e;color:#c084fc;font-family:ui-monospace,'SF Mono','Courier New',monospace;font-size:22px;font-weight:700;-webkit-appearance:none;appearance:none;outline:none;">
      </div>
      <div style="display:flex;align-items:center;justify-content:space-between;">
        <div>
          <div style="font-family:ui-monospace,'SF Mono','Courier New',monospace;font-size:12px;font-weight:700;color:#c084fc;letter-spacing:1px;">üçΩÔ∏è RESTAURANT</div>
          <div style="font-family:ui-monospace,'SF Mono','Courier New',monospace;font-size:10px;color:#48484a;margin-top:2px;">Floor + coolers</div>
        </div>
        <input id="tally-restaurant" type="number" inputmode="decimal" placeholder="0"
          style="width:80px;height:46px;text-align:center;border-radius:10px;border:2px solid #3b0764;background:#1c1c1e;color:#c084fc;font-family:ui-monospace,'SF Mono','Courier New',monospace;font-size:22px;font-weight:700;-webkit-appearance:none;appearance:none;outline:none;">
      </div>
    </div>

    <!-- Total -->
    <div style="display:flex;align-items:center;justify-content:space-between;padding:14px 0;border-top:1px solid #2c2c2e;border-bottom:1px solid #2c2c2e;margin-bottom:20px;">
      <div style="font-family:ui-monospace,'SF Mono','Courier New',monospace;font-size:14px;font-weight:700;color:#e5e5e7;letter-spacing:1px;">TOTAL COUNT</div>
      <div id="tally-total" style="font-family:ui-monospace,'SF Mono','Courier New',monospace;font-size:28px;font-weight:700;color:#a78bfa;">0</div>
    </div>

    <button class="btn-confirm" onclick="confirmTally()" style="background:#7c3aed;border-color:#7c3aed;">‚úì  SET COUNT</button>
    <button class="btn-cancel" onclick="closeTallyModal()">Cancel</button>
  </div>
</div>

<!-- Toast -->
<div id="toast"></div>

<script>
// ‚îÄ‚îÄ‚îÄ DATA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const DEFAULT_SUPPLIERS = {
  ABCO: {
    color:"#1e4d35", accent:"#4ade80",
    schedule:"Sun ¬∑ Wed ¬∑ Thu optional ‚Äî before 3pm",
    contact:"Hal Nouvealty ¬∑ 512-801-5422 ¬∑ SMS",
    items:[
      {id:"abco-1",name:"Cutlery kit - to go silverware",pack:"250 ct",par:1},
      {id:"abco-2",name:"2 gal Ziploc Bags",pack:"100 ct",par:2},
      {id:"abco-3",name:"12 inch film",pack:"each",par:1},
      {id:"abco-4",name:"18 inch film",pack:"each",par:1},
      {id:"abco-5",name:"Heavy Duty Foil 18 inch",pack:"each",par:1},
      {id:"abco-6",name:"Trash Can Liners",pack:"200 ct",par:2},
      {id:"abco-7",name:"8oz To go Soup cup",pack:"500 ct",par:1},
      {id:"abco-8",name:"Lids for To go soup",pack:"500 ct",par:1},
      {id:"abco-9",name:"To Go cups 16 oz",pack:"1000 ct",par:1},
      {id:"abco-10",name:"To Go cup LIDS 16 oz",pack:"1000 ct",par:1},
      {id:"abco-11",name:"3.25 oz portion Cups To Go",pack:"2500 ct",par:1},
      {id:"abco-12",name:"Lids for 3oz portion cups",pack:"2500 ct",par:1},
      {id:"abco-13",name:"12oz To Go Coffee cup",pack:"1200 ct",par:0.25},
      {id:"abco-14",name:"LIDS for to go coffee cups",pack:"1200 ct",par:0.25},
      {id:"abco-15",name:"#1 Bio Pak (small to go)",pack:"6/450",par:1},
      {id:"abco-16",name:"#3 Bio Pak (large to go)",pack:"4/50 ct",par:3},
      {id:"abco-17",name:"To Go Bags Royal 70#",pack:"200 ct",par:1},
      {id:"abco-18",name:"Traveler Bags",pack:"250 ct",par:1},
      {id:"abco-19",name:"Bistro Bags",pack:"250 ct",par:1},
      {id:"abco-20",name:"Filter machine filters (17.5\"x28\')",pack:"4 ct",par:1},
    ]
  },
  BEK: {
    color:"#0f172a", accent:"#60a5fa",
    schedule:"Sun ¬∑ Wed ¬∑ Fri ‚Äî before 4pm",
    contact:"BekEntree.com ¬∑ Bartletts@bartlettsaustin.com",
    items:[
      {id:"bek-1",name:"Metal bullets 3oz",pack:"12 ct",par:5},
      {id:"bek-2",name:"Birthday Candles",pack:"12/24",par:0.5},
      {id:"bek-3",name:"Thermometer Probe Wipes",pack:"200 ct",par:1},
      {id:"bek-4",name:"Coffee Filters 1.5 gal",pack:"500 ct",par:0.25},
      {id:"bek-5",name:'Patty Paper Square 5.5"',pack:"1000 ct",par:1},
      {id:"bek-6",name:"Poly Gloves Large",pack:"10/100",par:8},
      {id:"bek-7",name:"Poly Gloves Medium",pack:"10/100",par:2},
      {id:"bek-8",name:"Nitrile Gloves Large",pack:"10/100",par:4},
      {id:"bek-9",name:"Cheese Cloth",pack:"500 ft.",par:1},
      {id:"bek-10",name:"Liner Pan Paper",pack:"1000 ct",par:0.25},
      {id:"bek-11",name:'Wooden Skewers 4.5"',pack:"1000 ct",par:1},
      {id:"bek-12",name:"Foil sheets 12 x 10.75",pack:"200 ct",par:1},
      {id:"bek-13",name:"Use First Labels",pack:"‚Äî",par:1},
      {id:"bek-14",name:"Day dots - MONDAY",pack:"1000 ROLL",par:1},
      {id:"bek-15",name:"Day dots - TUESDAY",pack:"1000 ROLL",par:1},
      {id:"bek-16",name:"Day dots - WEDNESDAY",pack:"1000 ROLL",par:1},
      {id:"bek-17",name:"Day dots - THURSDAY",pack:"1000 ROLL",par:1},
      {id:"bek-18",name:"Day dots - FRIDAY",pack:"1000 ROLL",par:1},
      {id:"bek-19",name:"Day dots - SATURDAY",pack:"1000 ROLL",par:1},
      {id:"bek-20",name:"Day dots - SUNDAY",pack:"1000 ROLL",par:1},
      {id:"bek-21",name:"Day dots - Large Label",pack:"500 ct",par:2},
      {id:"bek-22",name:"Portion Bags - essential",pack:"2000 ct",par:1},
      {id:"bek-23",name:"Hand soap Safeguard",pack:"2/1gal",par:1},
      {id:"bek-24",name:"Hand Soap (orange)",pack:"4/750ml",par:4},
      {id:"bek-25",name:"Hand Sanitizer (clear)",pack:"4/750ml",par:4},
      {id:"bek-26",name:"Glass Cleaner",pack:"12/32 oz",par:2},
      {id:"bek-27",name:"Oven Cleaner",pack:"8 ct",par:4},
      {id:"bek-28",name:"Green Scrub pads",pack:"20 ct",par:1},
      {id:"bek-29",name:"Z fold paper towels",pack:"12/120 ct",par:1},
      {id:"bek-30",name:"Charmin toilet paper",pack:"60ct",par:1},
      {id:"bek-31",name:"Towel Roll non Perf 7.75 Wht",pack:"6/700 ft",par:4},
      {id:"bek-32",name:"Toilet Seat Covers",pack:"20/250",par:2},
      {id:"bek-33",name:"Bag paper sanitary recept",pack:"250 ct",par:0.5},
      {id:"bek-34",name:"Clear straw wrapped",pack:"1/400",par:4},
      {id:"bek-35",name:"Brown paper bag 8#",pack:"500 ea",par:0.25},
      {id:"bek-36",name:"1 comp to go black 11x8",pack:"100 ct",par:2},
      {id:"bek-37",name:"2 comp to go black 11x8",pack:"100 ct",par:2},
      {id:"bek-38",name:"salad to go large 9x3",pack:"100 ct",par:2},
      {id:"bek-39",name:"salad to go small 6x2.5",pack:"200 ct",par:1},
      {id:"bek-40",name:"Lemon Wraps",pack:"10/100ct",par:2},
      {id:"bek-41",name:"Bleach",pack:"6/1 gl",par:2},
      {id:"bek-42",name:"Ajax cleanser",pack:"24 ct",par:2},
      {id:"bek-43",name:"Plastic Aprons",pack:"6ct",par:1},
      {id:"bek-44",name:"Mop Head",pack:"3 ct",par:2},
      {id:"bek-45",name:"Water Softener Salt",pack:"1 lb",par:5},
      {id:"bek-46",name:"Fryer Oil (Wed/Thu dump)",pack:"each",par:10},
    ]
  },
  AMAZON: {
    color:"#7c2d12", accent:"#fb923c",
    schedule:"As needed ‚Äî check weekly",
    contact:"bartletts@bartlettsaustin.com ¬∑ 2408Anderson!",
    items:[
      {id:"amz-1",name:"Mineral oil",pack:"1 gallon",par:2},
      {id:"amz-2",name:"Lexol Leather conditioner",pack:"3 Liters",par:1},
      {id:"amz-3",name:"Minwax paste finishing wax",pack:"1 lb",par:1},
      {id:"amz-4",name:"Max tight isopropyl Alcohol",pack:"4 gallon",par:1},
      {id:"amz-5",name:"Dental floss picks",pack:"200 ct",par:4},
      {id:"amz-6",name:"Chicco Caddy High chair",pack:"1 chair",par:6},
      {id:"amz-7",name:'E-Gtong 9" Spring mold pan',pack:"1 pan",par:6},
      {id:"amz-8",name:"Tenagoo tea cup Charcoal gray",pack:"4/pack",par:24},
      {id:"amz-9",name:'Sweetjar ceramic Pie pan 10"',pack:"1/pack",par:24},
      {id:"amz-10",name:'Honeydak Extra long gloves 27.5"',pack:"2/pack",par:1},
      {id:"amz-11",name:'Blue rubber bandaid 1"x 3"',pack:"1500/pack",par:1},
      {id:"amz-12",name:"Blue Nitrol finger cots",pack:"144/pack",par:1},
      {id:"amz-13",name:"Jasai 18oz clear soap dispenser",pack:"1/pack",par:1},
      {id:"amz-14",name:"Shark rechargeable carpet sweeper",pack:"1 vacuum",par:1},
      {id:"amz-15",name:"Rubbermaid 4 comp. plastic cutlery bin",pack:"1 pack",par:6},
    ]
  },
  TRIMARK: {
    color:"#3b0764", accent:"#c084fc",
    schedule:"Monthly ‚Äî after inventory",
    contact:"James Hawley ¬∑ James.Hawley@trimarkusa.com",
    items:[
      {id:"tri-1", name:"Rocks glasses",       pack:"case", par:72,  unitCost:9.59},
      {id:"tri-2", name:"Collins glasses",      pack:"case", par:72,  unitCost:9.59},
      {id:"tri-3", name:"Beer Glass",           pack:"case", par:48,  unitCost:5.17},
      {id:"tri-4", name:"Tea Glass",            pack:"case", par:400, unitCost:3.54},
      {id:"tri-5", name:"Champagne glasses",    pack:"case", par:36,  unitCost:12.27},
      {id:"tri-6", name:"Martini glasses",      pack:"case", par:100, unitCost:9.38},
      {id:"tri-7", name:"Cordial glasses",      pack:"case", par:24,  unitCost:3.42},
      {id:"tri-8", name:"Brandy snifters",      pack:"case", par:12,  unitCost:2.47},
      {id:"tri-9", name:"Port wine glasses",    pack:"case", par:12,  unitCost:5.40},
      {id:"tri-10",name:"Whiskey glasses",      pack:"case", par:12,  unitCost:11.25},
      {id:"tri-11",name:"Wine glasses",         pack:"case", par:124, unitCost:5.77},
      {id:"tri-12",name:"Espresso Cup",         pack:"case", par:12,  unitCost:2.05},
      {id:"tri-13",name:"Espresso Saucer",      pack:"case", par:12,  unitCost:0.80},
      {id:"tri-14",name:"Cappuccino cup",       pack:"case", par:60,  unitCost:1.01},
      {id:"tri-15",name:"Cappuccino saucer",    pack:"case", par:48,  unitCost:0.80},
      {id:"tri-16",name:"Latte Cup",            pack:"case", par:24,  unitCost:15.94},
      {id:"tri-17",name:"Latte Saucer",         pack:"case", par:12,  unitCost:0.80},
      {id:"tri-18",name:"Coffee Mugs",          pack:"case", par:48,  unitCost:2.44},
      {id:"tri-19",name:'Salad Plate 11"',      pack:"case", par:100, unitCost:29.04},
      {id:"tri-20",name:"Chksal bowls",         pack:"case", par:72,  unitCost:18.91},
      {id:"tri-21",name:"Bird bowl",            pack:"case", par:56,  unitCost:32.17},
      {id:"tri-22",name:'Ala plate 10"',        pack:"case", par:150, unitCost:20.62},
      {id:"tri-23",name:"Platter plates",       pack:"case", par:100, unitCost:38.96},
      {id:"tri-24",name:"Thai plates",          pack:"case", par:60,  unitCost:27.67},
      {id:"tri-25",name:"Soup bowl",            pack:"case", par:84,  unitCost:8.59},
      {id:"tri-26",name:"Chili bowl",           pack:"case", par:36,  unitCost:5.50},
      {id:"tri-27",name:"Spin bowl",            pack:"case", par:84,  unitCost:9.08},
      {id:"tri-28",name:"Gravy Boats",          pack:"case", par:24,  unitCost:34.46},
      {id:"tri-29",name:'Key Lime pie plate',   pack:"case", par:24,  unitCost:34.99},
      {id:"tri-30",name:"Metal ramekin",        pack:"case", par:72,  unitCost:7.48},
      {id:"tri-31",name:"Tip plate",            pack:"case", par:250, unitCost:3.29},
      {id:"tri-32",name:"Fork",                 pack:"case", par:500, unitCost:3.08},
      {id:"tri-33",name:"Knife",                pack:"case", par:500, unitCost:4.25},
      {id:"tri-34",name:"Steak knife",          pack:"case", par:50,  unitCost:14.92},
      {id:"tri-35",name:"Spoon",                pack:"case", par:144, unitCost:2.34},
      {id:"tri-36",name:"Iced tea spoons",      pack:"case", par:144, unitCost:1.97},
      {id:"tri-37",name:"Coffee spoons",        pack:"case", par:48,  unitCost:1.49},
      {id:"tri-38",name:"S & P mills",          pack:"each", par:60,  unitCost:46.00},
      {id:"tri-39",name:"Waiter Aprons",        pack:"each", par:5,   unitCost:37.00},
      {id:"tri-40",name:"Chefs hats",           pack:"each", par:15,  unitCost:13.00},
      {id:"tri-41",name:"Pate Knives",          pack:"each", par:36,  unitCost:10.22},
    ]
  }
};

const SUP_NAMES = Object.keys(DEFAULT_SUPPLIERS);

// ‚îÄ‚îÄ‚îÄ STATE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let state = {
  tab: 'order',
  activeSupp: 'ABCO',
  onHand: {},
  orderQty: {},
  itemNotes: {},
  globalNote: '',
  editMode: false,
  editingItem: null,
  history: [],
  selectedRec: null,
  filterSup: 'ALL',
  catalog: JSON.parse(JSON.stringify(DEFAULT_SUPPLIERS)),
  breakage: {},           // tri item id ‚Üí qty broken this month
  trimarkBegin: {},       // tri item id ‚Üí beginning inventory count
  trimarkView: 'order',   // 'order' | 'inventory'
  trimarkTally: {},        // tri item id ‚Üí {dock, closet, restaurant}
};

// ‚îÄ‚îÄ‚îÄ STORAGE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function lsGet(k) { try { return JSON.parse(localStorage.getItem(k)); } catch { return null; } }
function lsSet(k, v) { try { localStorage.setItem(k, JSON.stringify(v)); } catch {} }

// ‚îÄ‚îÄ‚îÄ FIREBASE SYNC ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const FB_CONFIG = {
  databaseURL: "https://bartletts-rest-op-default-rtdb.firebaseio.com"
};
let fbDb = null;
let fbSyncStatus = 'offline'; // 'offline' | 'syncing' | 'synced' | 'error'

function initFirebase() {
  // If firebase SDK hasn't loaded yet (e.g. slow network), retry after delay
  if (typeof firebase === 'undefined') {
    console.warn('Firebase SDK not loaded yet, retrying in 2s‚Ä¶');
    fbSyncStatus = 'syncing';
    updateSyncBadge();
    setTimeout(initFirebase, 2000);
    return;
  }
  try {
    if (!firebase.apps.length) firebase.initializeApp(FB_CONFIG);
    fbDb = firebase.database();
    // Listen for history changes from any device
    fbDb.ref('history').on('value', snap => {
      const data = snap.val();
      if (data) {
        const incoming = Object.values(data).sort((a,b) => new Date(b.date) - new Date(a.date));
        // Merge with local ‚Äî keep all unique by date+id
        const merged = mergeHistory(state.history, incoming);
        state.history = merged;
        lsSet('bartletts-orders-v3', state.history);
        if (state.tab === 'history') renderHistoryView();
      }
      fbSyncStatus = 'synced';
      updateSyncBadge();
    }, err => {
      console.warn('Firebase sync error:', err);
      fbSyncStatus = 'error';
      updateSyncBadge();
    });
    fbSyncStatus = 'syncing';
    updateSyncBadge();
  } catch(e) {
    console.warn('Firebase init failed:', e);
    fbSyncStatus = 'error';
    updateSyncBadge();
  }
}

function mergeHistory(local, remote) {
  const map = new Map();
  [...local, ...remote].forEach(r => {
    const key = r.id || r.date;
    if (!map.has(key)) map.set(key, r);
  });
  return Array.from(map.values()).sort((a,b) => new Date(b.date) - new Date(a.date)).slice(0, 365);
}

function fbSaveRecord(rec) {
  if (!fbDb) return;
  // Use a sanitized key from the date
  const key = 'rec_' + new Date(rec.date).getTime();
  rec.id = rec.id || key;
  fbDb.ref('history/' + rec.id).set(rec).catch(e => console.warn('FB save error:', e));
}

function updateSyncBadge() {
  const el = document.getElementById('sync-badge');
  if (!el) return;
  const icons = { offline:'üìµ', syncing:'üîÑ', synced:'‚òÅÔ∏è', error:'‚ö†Ô∏è' };
  const colors = { offline:'#48484a', syncing:'#fbbf24', synced:'#4ade80', error:'#f87171' };
  el.textContent = icons[fbSyncStatus];
  el.title = { offline:'Offline', syncing:'Connecting‚Ä¶', synced:'Synced across devices', error:'Sync error' }[fbSyncStatus];
  el.style.color = colors[fbSyncStatus];
}

function loadPersistedData() {
  const hist = lsGet('bartletts-orders-v3');
  if (hist) state.history = hist;

  const cat = lsGet('bartletts-catalog-v1');
  if (cat) {
    for (const sn of SUP_NAMES) {
      if (cat[sn]?.items) state.catalog[sn].items = cat[sn].items;
    }
  }

  const brk = lsGet('bartletts-breakage-v1');
  if (brk) state.breakage = brk;
  const beg = lsGet('bartletts-trimark-begin-v1');
  if (beg) {
    state.trimarkBegin = beg;
  } else {
    // Pre-loaded from December 2025 ending counts (breakage report)
    state.trimarkBegin = {
      'tri-1':  97,   // Rocks glasses
      'tri-2':  100,  // Collins glasses
      'tri-3':  99,   // Beer Glass
      'tri-4':  439,  // Tea Glass
      'tri-5':  46,   // Champagne glasses
      'tri-6':  161,  // Martini glasses
      'tri-7':  53,   // Cordial glasses
      'tri-8':  31,   // Brandy snifters
      'tri-9':  33,   // Port wine glasses
      'tri-10': 22,   // Whiskey glasses
      'tri-11': 160,  // Wine glasses
      'tri-12': 14,   // Espresso Cup
      'tri-13': 9,    // Espresso Saucer
      'tri-14': 85,   // Cappuccino cup
      'tri-15': 92,   // Cappuccino saucer
      'tri-16': 20,   // Latte Cup
      'tri-17': 15,   // Latte Saucer
      'tri-18': 66,   // Coffee Mugs
      'tri-19': 155,  // Salad Plate 11"
      'tri-20': 108,  // Chksal bowls
      'tri-21': 98,   // Bird bowl
      'tri-22': 190,  // Ala plate 10"
      'tri-23': 124,  // Platter plates
      'tri-24': 74,   // Thai plates
      'tri-25': 94,   // Soup bowl
      'tri-26': 77,   // Chili bowl
      'tri-27': 102,  // Spin bowl
      'tri-28': 37,   // Gravy Boats
      'tri-29': 30,   // Key Lime pie plate
      'tri-30': 108,  // Metal ramekin
      'tri-31': 413,  // Tip plate
      'tri-32': 593,  // Fork
      'tri-33': 612,  // Knife
      'tri-34': 91,   // Steak knife
      'tri-35': 127,  // Spoon
      'tri-36': 165,  // Iced tea spoons
      'tri-37': 68,   // Coffee spoons
      'tri-38': 86,   // S & P mills
      'tri-39': 33,   // Waiter Aprons
      'tri-40': 30,   // Chefs hats
      'tri-41': 39,   // Pate Knives
    };
    saveTrimarkBegin();
  }
  const tal = lsGet('bartletts-trimark-tally-v1');
  if (tal) state.trimarkTally = tal;
}

function saveBreakage() {
  lsSet('bartletts-breakage-v1', state.breakage);
}

function saveTrimarkBegin() {
  lsSet('bartletts-trimark-begin-v1', state.trimarkBegin);
}

function saveTrimarkTally() {
  lsSet('bartletts-trimark-tally-v1', state.trimarkTally);
}

function saveCatalog() {
  const toStore = {};
  for (const sn of SUP_NAMES) toStore[sn] = { items: state.catalog[sn].items };
  lsSet('bartletts-catalog-v1', toStore);
}

// ‚îÄ‚îÄ‚îÄ HELPERS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function ikey(sn, id) { return sn + '|' + id; }

function getStatus(oh, par) {
  const h = parseFloat(oh), p = parseFloat(par);
  if (oh === '' || oh == null || isNaN(h)) return null;
  if (h <= 0) return 'critical';
  if (!isNaN(p) && h < p) return 'low';
  return 'ok';
}

const STATUS_ICONS = { critical:'üî¥', low:'üü°', ok:'üü¢' };

let toastTimer = null;
function showToast(msg, type='ok') {
  const el = document.getElementById('toast');
  el.textContent = msg;
  el.className = 'show' + (type !== 'ok' ? ' ' + type : '');
  if (toastTimer) clearTimeout(toastTimer);
  toastTimer = setTimeout(() => { el.className = ''; }, 3000);
}

// ‚îÄ‚îÄ‚îÄ RENDER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function render() {
  renderTopBar();
  if (state.tab === 'order') renderOrderView();
  else if (state.tab === 'history') renderHistoryView();
  else if (state.tab === 'mustknow') renderMustKnow();
  renderTabBar();
}

function renderTopBar() {
  document.getElementById('today-date').textContent =
    new Date().toLocaleDateString('en-US', {weekday:'short', month:'short', day:'numeric'});

  const btnEdit = document.getElementById('btn-edit');
  const btnSave = document.getElementById('btn-save');

  if (state.tab === 'order') {
    btnEdit.style.display = 'flex';
    btnSave.style.display = state.editMode ? 'none' : 'flex';
    btnEdit.className = 'btn-edit' + (state.editMode ? ' active' : '');
    btnEdit.textContent = state.editMode ? '‚úé Editing' : '‚úé Edit';
  } else {
    btnEdit.style.display = 'none';
    btnSave.style.display = 'none';
  }
}

function renderTabBar() {
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  const activeTab = document.getElementById('tab-' + state.tab);
  if (activeTab) activeTab.classList.add('active');
  const ind = activeTab?.querySelector('.tab-indicator');
  document.querySelectorAll('.tab-indicator').forEach(i => i.remove());
  if (activeTab) {
    const d = document.createElement('div');
    d.className = 'tab-indicator';
    activeTab.prepend(d);
  }
}

// ‚îÄ‚îÄ‚îÄ ORDER VIEW ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderOrderView() {
  document.getElementById('view-order').style.display = 'flex';
  document.getElementById('view-history').style.display = 'none';
  document.getElementById('view-mustknow').style.display = 'none';

  const sup = state.catalog[state.activeSupp];
  const defSup = DEFAULT_SUPPLIERS[state.activeSupp];

  // Supplier tabs
  const tabsEl = document.getElementById('sup-tabs');
  tabsEl.innerHTML = '';
  for (const sn of SUP_NAMES) {
    const s = state.catalog[sn];
    const active = sn === state.activeSupp;
    const cnt = s.items.filter(i => (state.onHand[ikey(sn, i.id)] ?? '') !== '').length;
    const btn = document.createElement('button');
    btn.className = 'sup-tab' + (active ? ' active' : '');
    btn.style.cssText = `border-color:${active ? s.accent : '#2c2c2e'};background:${active ? s.color : '#1c1c1e'}`;
    btn.innerHTML = sn + (cnt > 0 ? `<span class="sup-tab-badge" style="background:${s.accent};color:#000">${cnt}</span>` : '');
    btn.onclick = () => {
      state.activeSupp = sn;
      state.trimarkView = 'order'; // always start on order view when switching suppliers
      render();
      document.getElementById('item-list').scrollTop = 0;
    };
    tabsEl.appendChild(btn);
  }

  // Sup info
  const crit = sup.items.filter(i => getStatus(state.onHand[ikey(state.activeSupp, i.id)] ?? '', i.par) === 'critical').length;
  const low  = sup.items.filter(i => getStatus(state.onHand[ikey(state.activeSupp, i.id)] ?? '', i.par) === 'low').length;
  const infoEl = document.getElementById('sup-info');
  infoEl.style.background = sup.color;

  // For Trimark: show inventory toggle button
  const trimarkBtn = state.activeSupp === 'TRIMARK' ? `
    <button onclick="toggleTrimarkView()" style="
      margin-top:8px;padding:6px 14px;border-radius:20px;border:1.5px solid #c084fc;
      background:${state.trimarkView==='inventory'?'#c084fc':'transparent'};
      color:${state.trimarkView==='inventory'?'#000':'#c084fc'};
      font-family:ui-monospace,'SF Mono','Courier New',monospace;font-size:11px;font-weight:700;letter-spacing:0.5px;
      cursor:pointer;display:inline-flex;align-items:center;gap:6px;">
      üìã INVENTORY COUNT
    </button>` : '';

  infoEl.innerHTML = `
    <div class="sup-info-sched">üìÖ ${defSup.schedule}</div>
    <div class="sup-info-contact">${defSup.contact}</div>
    ${trimarkBtn}
    ${!state.editMode && (crit > 0 || low > 0) ? `<div class="sup-info-alerts">
      ${crit > 0 ? `<span style="color:#f87171;font-family:ui-monospace,'SF Mono','Courier New',monospace;font-size:11px">üî¥ ${crit} critical</span>` : ''}
      ${low  > 0 ? `<span style="color:#fbbf24;font-family:ui-monospace,'SF Mono','Courier New',monospace;font-size:11px">üü° ${low} low</span>` : ''}
    </div>` : ''}
    ${state.editMode ? `<div style="color:#fbbf24;font-family:ui-monospace,'SF Mono','Courier New',monospace;font-size:11px;margin-top:4px">‚úé Tap any item to edit name, pack size, or par</div>` : ''}
  `;

  // Edit banner
  document.getElementById('edit-banner').style.display = state.editMode ? 'flex' : 'none';

  // Items
  const listEl = document.getElementById('item-list');
  listEl.innerHTML = '';

  // Trimark inventory sub-view
  if (state.activeSupp === 'TRIMARK' && state.trimarkView === 'inventory') {
    renderTrimarkInventory(listEl, sup);
    return;
  }

  sup.items.forEach(item => {
    const ik  = ikey(state.activeSupp, item.id);
    const oh  = state.onHand[ik] ?? '';
    const oq  = state.orderQty[ik] ?? '';
    const nt  = state.itemNotes[ik] ?? '';
    const st  = getStatus(oh, item.par);
    const rowBg = st === 'critical' ? 'rgba(248,113,113,0.09)' : st === 'low' ? 'rgba(251,191,36,0.07)' : 'transparent';

    const row = document.createElement('div');
    row.className = 'item-row';
    row.style.background = rowBg;

    // Inner
    const inner = document.createElement('div');
    inner.className = 'item-row-inner';

    if (state.editMode) {
      const editBtn = document.createElement('button');
      editBtn.className = 'edit-item-btn';
      editBtn.innerHTML = '‚úé';
      editBtn.onclick = () => startEdit(state.activeSupp, item);
      inner.appendChild(editBtn);
    }

    // Name col
    const nameCol = document.createElement('div');
    nameCol.style.cssText = 'flex:1;min-width:0';
    // Show begin count as a tag in order view for Trimark
    const beginVal = state.trimarkBegin[item.id];
    const endingVal = state.onHand[ikey('TRIMARK', item.id)] ?? '';
    const usageVal = (state.activeSupp === 'TRIMARK' && beginVal !== undefined && endingVal !== '') ? (parseFloat(beginVal)||0) - (parseFloat(endingVal)||0) : null;
    const brkDisplay = (state.activeSupp === 'TRIMARK' && !state.editMode && beginVal !== undefined)
      ? `<span style="color:#a78bfa;font-family:ui-monospace,'SF Mono','Courier New',monospace;font-size:10px;margin-left:6px">beg:${beginVal}${usageVal!==null?' used:'+usageVal:''}</span>` : '';
    nameCol.innerHTML = `
      <div class="item-name">${item.name}${brkDisplay}</div>
      <div class="item-meta">
        <span>${item.pack}</span><span style="color:#2c2c2e">¬∑</span>
        <span>par <span ${state.editMode ? 'style="color:#fbbf24"' : ''}>${item.par}</span></span>
      </div>`;
    inner.appendChild(nameCol);

    if (!state.editMode) {
      // On Hand input
      const ohCol = document.createElement('div');
      ohCol.className = 'inp-col';
      ohCol.innerHTML = `<span class="inp-label">ON HAND</span>`;
      const ohInp = document.createElement('input');
      ohInp.type = 'number'; ohInp.inputMode = 'decimal';
      ohInp.className = 'inp-field';
      ohInp.value = oh; ohInp.placeholder = '‚Äî';
      ohInp.style.borderColor = oh !== '' ? sup.accent : '#2c2c2e';
      ohInp.addEventListener('input', e => {
        state.onHand[ik] = e.target.value;
        // Live update row bg and status
        const newSt = getStatus(e.target.value, item.par);
        row.style.background = newSt === 'critical' ? 'rgba(248,113,113,0.09)' : newSt === 'low' ? 'rgba(251,191,36,0.07)' : 'transparent';
        ohInp.style.borderColor = e.target.value !== '' ? sup.accent : '#2c2c2e';
        // Update status icon
        const sIcon = inner.querySelector('.status-icon');
        if (sIcon) sIcon.textContent = newSt ? STATUS_ICONS[newSt] : '';
        // ‚îÄ‚îÄ AUTO-FILL ORDER QTY ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        // Only auto-fill if the user hasn't manually typed a qty yet
        const ohVal = parseFloat(e.target.value);
        const parVal = parseFloat(item.par);
        if (!isNaN(ohVal) && !isNaN(parVal) && e.target.value !== '') {
          // For Trimark: order = par - ending + (begin - ending = usage portion to restore)
          // Actually: order = par - ending (simple par-based ordering; usage is tracked separately)
          const suggested = Math.max(0, parVal - ohVal);
          // Round to sensible precision (whole numbers unless par is fractional)
          const rounded = parVal % 1 === 0 ? Math.ceil(suggested) : Math.round(suggested * 4) / 4;
          const currentOq = state.orderQty[ik] ?? '';
          // Only fill if field is empty or was previously auto-filled (not manually edited)
          if (currentOq === '' || state._autoFilled?.[ik]) {
            state.orderQty[ik] = rounded > 0 ? String(rounded) : '';
            if (!state._autoFilled) state._autoFilled = {};
            state._autoFilled[ik] = true;
            // Update the order qty input visually
            const oqInp = inner.querySelector('.oq-input');
            if (oqInp) {
              const v = state.orderQty[ik];
              oqInp.value = v;
              oqInp.style.borderColor = v ? '#f97316' : '#2c2c2e';
              oqInp.style.color = v ? '#f97316' : '#fff';
              oqInp.style.fontWeight = v ? '700' : '400';
            }
          }
        } else if (e.target.value === '') {
          // Cleared on-hand ‚Äî clear auto-filled order qty too
          if (state._autoFilled?.[ik]) {
            state.orderQty[ik] = '';
            delete state._autoFilled[ik];
            const oqInp = inner.querySelector('.oq-input');
            if (oqInp) { oqInp.value = ''; oqInp.style.borderColor='#2c2c2e'; oqInp.style.color='#fff'; oqInp.style.fontWeight='400'; }
          }
        }
        // Update tab badge
        updateTabBadge(state.activeSupp);
        updateSupInfo();
      });
      ohCol.appendChild(ohInp);
      inner.appendChild(ohCol);

      // Order qty input
      const oqCol = document.createElement('div');
      oqCol.className = 'inp-col';
      oqCol.innerHTML = `<span class="inp-label">ORDER</span>`;
      const oqInp = document.createElement('input');
      oqInp.type = 'number'; oqInp.inputMode = 'decimal';
      oqInp.className = 'inp-field oq-input';
      oqInp.value = oq; oqInp.placeholder = '‚Äî';
      oqInp.style.cssText = `border-color:${oq !== '' ? '#f97316' : '#2c2c2e'};color:${oq !== '' ? '#f97316' : '#fff'};font-weight:${oq !== '' ? 700 : 400}`;
      oqInp.addEventListener('input', e => {
        state.orderQty[ik] = e.target.value;
        // Mark as manually edited ‚Äî autofill won't override this
        if (!state._autoFilled) state._autoFilled = {};
        if (e.target.value !== '') {
          state._autoFilled[ik] = false; // false = manual edit
        } else {
          delete state._autoFilled[ik];
        }
        const v = e.target.value;
        oqInp.style.borderColor = v ? '#f97316' : '#2c2c2e';
        oqInp.style.color = v ? '#f97316' : '#fff';
        oqInp.style.fontWeight = v ? '700' : '400';
      });
      oqCol.appendChild(oqInp);
      inner.appendChild(oqCol);

      // Status + note
      const rightCol = document.createElement('div');
      rightCol.style.cssText = 'display:flex;flex-direction:column;align-items:center;gap:4px;width:34px';
      const sIcon = document.createElement('span');
      sIcon.className = 'status-icon';
      sIcon.style.fontSize = '16px';
      sIcon.textContent = st ? STATUS_ICONS[st] : '';
      const noteBtn = document.createElement('button');
      noteBtn.className = 'note-btn' + (nt ? ' has-note' : '');
      noteBtn.innerHTML = '‚úé';
      noteBtn.onclick = () => toggleNoteDrawer(row, ik, nt);
      rightCol.appendChild(sIcon);
      rightCol.appendChild(noteBtn);
      inner.appendChild(rightCol);
    }

    row.appendChild(inner);

    // Note drawer (if open)
    if (!state.editMode && state._openNote === ik) {
      const drawer = document.createElement('div');
      drawer.className = 'note-drawer';
      const ta = document.createElement('textarea');
      ta.className = 'note-textarea';
      ta.rows = 2; ta.value = nt;
      ta.placeholder = 'Note for this item‚Ä¶';
      ta.addEventListener('input', e => { state.itemNotes[ik] = e.target.value; });
      drawer.appendChild(ta);
      row.appendChild(drawer);
      setTimeout(() => ta.focus(), 50);
    }

    listEl.appendChild(row);
  });

  // Global notes
  if (!state.editMode) {
    const notesArea = document.createElement('div');
    notesArea.className = 'global-notes-area';
    notesArea.innerHTML = `<div class="section-label"><span style="font-size:16px">üìù</span> ORDER NOTES</div>`;
    const ta = document.createElement('textarea');
    ta.className = 'global-textarea' + (state.globalNote ? ' has-content' : '');
    ta.rows = 4; ta.value = state.globalNote;
    ta.placeholder = 'General notes, reminders, follow-ups‚Ä¶';
    ta.addEventListener('input', e => {
      state.globalNote = e.target.value;
      ta.className = 'global-textarea' + (e.target.value ? ' has-content' : '');
    });
    notesArea.appendChild(ta);
    listEl.appendChild(notesArea);
  }

  const spacer = document.createElement('div');
  spacer.className = 'safe-bottom';
  listEl.appendChild(spacer);
}

function toggleNoteDrawer(row, ik, currentNote) {
  if (state._openNote === ik) {
    state._openNote = null;
  } else {
    state._openNote = ik;
  }
  renderOrderView();
}

function updateTabBadge(sn) {
  const s = state.catalog[sn];
  const cnt = s.items.filter(i => (state.onHand[ikey(sn, i.id)] ?? '') !== '').length;
  // Find and update this tab's badge
  const tabs = document.querySelectorAll('.sup-tab');
  tabs.forEach(t => {
    if (t.textContent.trim().startsWith(sn)) {
      const badge = t.querySelector('.sup-tab-badge');
      if (cnt > 0) {
        if (!badge) {
          const b = document.createElement('span');
          b.className = 'sup-tab-badge';
          b.style.cssText = `background:${s.accent};color:#000`;
          b.textContent = cnt;
          t.appendChild(b);
        } else badge.textContent = cnt;
      } else if (badge) badge.remove();
    }
  });
}

function updateSupInfo() {
  const sup = state.catalog[state.activeSupp];
  const defSup = DEFAULT_SUPPLIERS[state.activeSupp];
  const crit = sup.items.filter(i => getStatus(state.onHand[ikey(state.activeSupp, i.id)] ?? '', i.par) === 'critical').length;
  const low  = sup.items.filter(i => getStatus(state.onHand[ikey(state.activeSupp, i.id)] ?? '', i.par) === 'low').length;
  const alertsEl = document.querySelector('.sup-info-alerts');
  if (alertsEl) alertsEl.remove();
  const infoEl = document.getElementById('sup-info');
  if (!state.editMode && (crit > 0 || low > 0)) {
    const d = document.createElement('div');
    d.className = 'sup-info-alerts';
    d.innerHTML = `
      ${crit > 0 ? `<span style="color:#f87171;font-family:ui-monospace,'SF Mono','Courier New',monospace;font-size:11px">üî¥ ${crit} critical</span>` : ''}
      ${low  > 0 ? `<span style="color:#fbbf24;font-family:ui-monospace,'SF Mono','Courier New',monospace;font-size:11px">üü° ${low} low</span>` : ''}`;
    infoEl.appendChild(d);
  }
}

// ‚îÄ‚îÄ‚îÄ TRIMARK INVENTORY VIEW ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function toggleTrimarkView() {
  state.trimarkView = state.trimarkView === 'inventory' ? 'order' : 'inventory';
  renderOrderView();
  document.getElementById('item-list').scrollTop = 0;
}

function getTrimarkSummary(sup) {
  // Compute totals for the summary bar
  let totalUsage = 0, totalBrkgCost = 0, needsOrder = 0;
  sup.items.forEach(item => {
    const ik = ikey('TRIMARK', item.id);
    const begVal = parseFloat(state.trimarkBegin[item.id]) || 0;
    const endVal = parseFloat(state.onHand[ik] ?? '') || 0;
    const hasBeg = state.trimarkBegin[item.id] !== undefined;
    const hasEnd = (state.onHand[ik] ?? '') !== '';
    if (hasBeg && hasEnd) {
      const usage = begVal - endVal;
      if (usage > 0) {
        totalUsage += usage;
        const cost = (item.unitCost || 0) * usage;
        totalBrkgCost += cost;
      }
    }
    const parVal = parseFloat(item.par) || 0;
    if (hasEnd && endVal < parVal) needsOrder++;
  });
  return { totalUsage, totalBrkgCost, needsOrder };
}

function renderTrimarkInventory(listEl, sup) {
  const summary = getTrimarkSummary(sup);

  // Header
  const hdr = document.createElement('div');
  hdr.style.cssText = 'padding:14px 16px 10px;background:#1c1c1e;border-bottom:1px solid #2c2c2e;';
  hdr.innerHTML = `
    <div style="font-family:ui-monospace,'SF Mono','Courier New',monospace;font-size:12px;font-weight:700;color:#c084fc;letter-spacing:1px;margin-bottom:4px">üìã MONTHLY INVENTORY COUNT</div>
    <div style="font-family:ui-monospace,'SF Mono','Courier New',monospace;font-size:10px;color:#636366;line-height:1.5">
      Enter BEGIN (last month's end) + COUNT (what you have now). Usage, loss $, and order qty auto-calculate.
    </div>`;
  listEl.appendChild(hdr);

  // Summary bar
  const summaryBar = document.createElement('div');
  summaryBar.id = 'tri-summary-bar';
  summaryBar.style.cssText = 'padding:10px 16px;background:#2c1654;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:8px;border-bottom:1px solid #3b0764;';
  summaryBar.innerHTML = buildTriSummaryHTML(summary);
  listEl.appendChild(summaryBar);

  // Column header
  const colHdr = document.createElement('div');
  colHdr.style.cssText = 'padding:6px 16px;background:#111;display:grid;grid-template-columns:1fr 64px 64px 64px 64px;gap:6px;align-items:center;border-bottom:1px solid #222;';
  colHdr.innerHTML = `
    <span style="font-family:ui-monospace,'SF Mono','Courier New',monospace;font-size:9px;color:#636366;letter-spacing:1px;">ITEM</span>
    <span style="font-family:ui-monospace,'SF Mono','Courier New',monospace;font-size:9px;color:#636366;letter-spacing:1px;text-align:center;">BEGIN</span>
    <span style="font-family:ui-monospace,'SF Mono','Courier New',monospace;font-size:9px;color:#c084fc;letter-spacing:1px;text-align:center;">COUNT</span>
    <span style="font-family:ui-monospace,'SF Mono','Courier New',monospace;font-size:9px;color:#f87171;letter-spacing:1px;text-align:center;">USED</span>
    <span style="font-family:ui-monospace,'SF Mono','Courier New',monospace;font-size:9px;color:#fbbf24;letter-spacing:1px;text-align:center;">ORDER</span>`;
  listEl.appendChild(colHdr);

  // Items
  sup.items.forEach((item, idx) => {
    const ik = ikey('TRIMARK', item.id);
    const begRaw = state.trimarkBegin[item.id];
    const endRaw = state.onHand[ik] ?? '';
    const begVal = parseFloat(begRaw);
    const endVal = parseFloat(endRaw);
    const hasBeg = begRaw !== undefined && begRaw !== '';
    const hasEnd = endRaw !== '';
    const usage = (hasBeg && hasEnd && !isNaN(begVal) && !isNaN(endVal)) ? begVal - endVal : null;
    const usagePos = usage !== null ? Math.max(0, usage) : null;
    const brkgCost = usagePos !== null ? usagePos * (item.unitCost || 0) : null;
    const parVal = parseFloat(item.par) || 0;
    const orderQty = hasEnd && !isNaN(endVal) ? Math.max(0, parVal - endVal) : null;
    const isLow = hasEnd && !isNaN(endVal) && endVal < parVal;
    const isCrit = hasEnd && !isNaN(endVal) && endVal <= 0;

    const row = document.createElement('div');
    row.style.cssText = `padding:10px 16px;border-bottom:1px solid #1c1c1e;display:grid;grid-template-columns:1fr 64px 64px 64px 64px;gap:6px;align-items:center;background:${isCrit ? 'rgba(248,113,113,0.09)' : isLow ? 'rgba(251,191,36,0.05)' : idx%2===0 ? '#0a0a0a' : 'transparent'};`;

    // Name col
    const nameDiv = document.createElement('div');
    nameDiv.innerHTML = `
      <div style="color:#e5e5e7;font-size:13px;line-height:1.3;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${item.name}</div>
      <div style="font-family:ui-monospace,'SF Mono','Courier New',monospace;font-size:10px;color:#48484a;margin-top:1px">par ${item.par}${item.unitCost ? ' ¬∑ $'+item.unitCost.toFixed(2) : ''}</div>
      ${brkgCost !== null && brkgCost > 0 ? `<div style="font-family:ui-monospace,'SF Mono','Courier New',monospace;font-size:10px;color:#f87171;margin-top:1px">loss: $${brkgCost.toFixed(2)}</div>` : ''}`;

    // Begin input
    const begCol = document.createElement('div');
    begCol.style.cssText = 'display:flex;align-items:center;justify-content:center;';
    const begInp = document.createElement('input');
    begInp.type='number'; begInp.inputMode='decimal';
    begInp.value = hasBeg ? begRaw : '';
    begInp.placeholder = '‚Äî';
    begInp.style.cssText = `width:56px;height:38px;text-align:center;border-radius:8px;border:2px solid ${hasBeg ? '#7c3aed' : '#2c2c2e'};background:#1c1c1e;color:${hasBeg ? '#a78bfa' : '#636366'};font-family:ui-monospace,'SF Mono','Courier New',monospace;font-size:16px;font-weight:700;-webkit-appearance:none;appearance:none;outline:none;`;
    begInp.addEventListener('input', e => {
      const val = e.target.value;
      if (val !== '') { state.trimarkBegin[item.id] = val; }
      else { delete state.trimarkBegin[item.id]; }
      saveTrimarkBegin();
      begInp.style.borderColor = val !== '' ? '#7c3aed' : '#2c2c2e';
      begInp.style.color = val !== '' ? '#a78bfa' : '#636366';
      refreshTriRow(row, item, ik, listEl, sup);
    });
    begCol.appendChild(begInp);

    // Ending/count input ‚Äî taps open location tally modal
    const endCol = document.createElement('div');
    endCol.style.cssText = 'display:flex;align-items:center;justify-content:center;';

    // Show tally breakdown if locations saved
    const tally = state.trimarkTally[item.id];
    const hasTally = tally && (tally.dock || tally.closet || tally.restaurant);

    const endBtn = document.createElement('div');
    endBtn.style.cssText = `width:56px;min-height:38px;text-align:center;border-radius:8px;border:2px solid ${hasEnd ? '#c084fc' : '#2c2c2e'};background:#1c1c1e;color:${hasEnd ? '#c084fc' : '#636366'};font-family:ui-monospace,'SF Mono','Courier New',monospace;font-size:${hasEnd ? '16px' : '13px'};font-weight:700;cursor:pointer;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:1px;padding:3px 2px;`;

    if (hasEnd) {
      endBtn.innerHTML = `<span style="font-size:16px;font-weight:700">${endRaw}</span>${hasTally ? `<span style="font-size:8px;color:#7c3aed;letter-spacing:0px;">${tally.dock||0}¬∑${tally.closet||0}¬∑${tally.restaurant||0}</span>` : ''}`;
    } else {
      endBtn.innerHTML = `<span style="font-size:13px;color:#48484a">TAP</span>`;
    }

    endBtn.addEventListener('click', () => {
      openTallyModal(item, (totalVal) => {
        // Update state
        state.onHand[ik] = totalVal;
        const pv = parseFloat(totalVal);
        if (!isNaN(pv)) {
          const suggested = Math.max(0, parVal - pv);
          state.orderQty[ik] = suggested > 0 ? String(Math.ceil(suggested)) : '';
          if (!state._autoFilled) state._autoFilled = {};
          state._autoFilled[ik] = true;
        } else {
          state.orderQty[ik] = '';
        }
        // Update button display
        const newTally = state.trimarkTally[item.id] || {};
        const nt = newTally;
        endBtn.style.borderColor = '#c084fc';
        endBtn.style.color = '#c084fc';
        endBtn.innerHTML = `<span style="font-size:16px;font-weight:700">${totalVal}</span><span style="font-size:8px;color:#7c3aed;letter-spacing:0px;">${nt.dock||0}¬∑${nt.closet||0}¬∑${nt.restaurant||0}</span>`;
        refreshTriRow(row, item, ik, listEl, sup);
      });
    });
    endCol.appendChild(endBtn);

    // Usage display
    const usageCol = document.createElement('div');
    usageCol.className = 'tri-usage-' + item.id;
    usageCol.style.cssText = 'text-align:center;font-family:ui-monospace,"SF Mono","Courier New",monospace;font-size:16px;font-weight:700;';
    usageCol.style.color = usagePos !== null && usagePos > 0 ? '#f87171' : '#48484a';
    usageCol.textContent = usagePos !== null ? (usagePos > 0 ? '-'+usagePos : '0') : '‚Äî';

    // Order qty display
    const orderCol = document.createElement('div');
    orderCol.className = 'tri-order-' + item.id;
    orderCol.style.cssText = 'text-align:center;font-family:ui-monospace,"SF Mono","Courier New",monospace;font-size:16px;font-weight:700;';
    orderCol.style.color = orderQty !== null && orderQty > 0 ? '#fbbf24' : '#48484a';
    orderCol.textContent = orderQty !== null ? (orderQty > 0 ? '+'+orderQty : '‚úì') : '‚Äî';

    row.appendChild(nameDiv);
    row.appendChild(begCol);
    row.appendChild(endCol);
    row.appendChild(usageCol);
    row.appendChild(orderCol);
    listEl.appendChild(row);
  });

  const spacer = document.createElement('div'); spacer.className = 'safe-bottom';
  listEl.appendChild(spacer);
}

function buildTriSummaryHTML(summary) {
  return `
    <span style="font-family:ui-monospace,'SF Mono','Courier New',monospace;font-size:11px;color:#a78bfa;">
      üì¶ ${summary.needsOrder} need ordering
    </span>
    <span style="font-family:ui-monospace,'SF Mono','Courier New',monospace;font-size:11px;color:#f87171;">
      üí∏ loss: $${summary.totalBrkgCost.toFixed(2)}
    </span>
    <button onclick="clearTrimarkInventory()" style="
      padding:4px 12px;border-radius:12px;border:1px solid #636366;
      background:transparent;color:#636366;
      font-family:ui-monospace,'SF Mono','Courier New',monospace;font-size:10px;font-weight:700;
      cursor:pointer;">‚Ü∫ RESET MONTH</button>`;
}

function refreshTriRow(row, item, ik, listEl, sup) {
  // Recalculate and re-render the usage, order cols, and name subline
  const begRaw = state.trimarkBegin[item.id];
  const endRaw = state.onHand[ik] ?? '';
  const begVal = parseFloat(begRaw);
  const endVal = parseFloat(endRaw);
  const hasBeg = begRaw !== undefined && begRaw !== '';
  const hasEnd = endRaw !== '';
  const usage = (hasBeg && hasEnd && !isNaN(begVal) && !isNaN(endVal)) ? begVal - endVal : null;
  const usagePos = usage !== null ? Math.max(0, usage) : null;
  const brkgCost = usagePos !== null ? usagePos * (item.unitCost || 0) : null;
  const parVal = parseFloat(item.par) || 0;
  const orderQty = hasEnd && !isNaN(endVal) ? Math.max(0, parVal - endVal) : null;

  const usageEl = listEl.querySelector('.tri-usage-' + item.id);
  if (usageEl) {
    usageEl.textContent = usagePos !== null ? (usagePos > 0 ? '-'+usagePos : '0') : '‚Äî';
    usageEl.style.color = usagePos !== null && usagePos > 0 ? '#f87171' : '#48484a';
  }
  const orderEl = listEl.querySelector('.tri-order-' + item.id);
  if (orderEl) {
    orderEl.textContent = orderQty !== null ? (orderQty > 0 ? '+'+orderQty : '‚úì') : '‚Äî';
    orderEl.style.color = orderQty !== null && orderQty > 0 ? '#fbbf24' : '#48484a';
  }
  // Update summary bar
  const summary = getTrimarkSummary(sup);
  const bar = document.getElementById('tri-summary-bar');
  if (bar) bar.innerHTML = buildTriSummaryHTML(summary);
}

function clearTrimarkInventory() {
  if (!confirm('Reset this month\'s inventory counts? This will clear all BEGIN counts and location tallies. Ending counts (on-hand) will be kept.')) return;
  state.trimarkBegin = {};
  state.trimarkTally = {};
  saveTrimarkBegin();
  saveTrimarkTally();
  showToast('Month reset ‚Äî enter new beginning counts', 'warn');
  renderOrderView();
}

function clearAllBreakage() {
  state.breakage = {};
  saveBreakage();
  showToast('Breakage cleared', 'warn');
  renderOrderView();
}

// ‚îÄ‚îÄ‚îÄ HISTORY VIEW ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderHistoryView() {
  document.getElementById('view-order').style.display = 'none';
  document.getElementById('view-history').style.display = 'flex';
  document.getElementById('view-mustknow').style.display = 'none';
  document.getElementById('hist-detail').classList.remove('show');

  if (state.selectedRec) {
    renderDetail(state.selectedRec);
    return;
  }

  // Filter chips
  const chipsEl = document.getElementById('filter-chips');
  chipsEl.innerHTML = '';
  ['ALL', ...SUP_NAMES].forEach(sn => {
    const btn = document.createElement('button');
    btn.className = 'chip' + (state.filterSup === sn ? ' active' : '');
    btn.textContent = sn === 'ALL' ? 'All' : sn;
    btn.onclick = () => { state.filterSup = sn; renderHistoryView(); };
    chipsEl.appendChild(btn);
  });

  const listEl = document.getElementById('history-list');
  listEl.innerHTML = '';

  const filtered = state.history.filter(r => state.filterSup === 'ALL' || r.suppliers?.[state.filterSup]);

  if (!filtered.length) {
    listEl.innerHTML = `<div class="empty-state"><div class="empty-icon">üïê</div><div class="empty-text">No orders saved yet.</div></div>`;
    return;
  }

  // Group by month
  const months = new Map();
  filtered.forEach(rec => {
    const d = new Date(rec.date);
    const key = `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}`;
    const label = d.toLocaleDateString('en-US', {month:'long', year:'numeric'});
    if (!months.has(key)) months.set(key, {label, key, records:[]});
    months.get(key).records.push(rec);
  });

  months.forEach(({label, key, records}) => {
    // Month header
    const monthHdr = document.createElement('div');
    monthHdr.style.cssText = 'padding:10px 16px 6px;display:flex;align-items:center;justify-content:space-between;background:#000;position:sticky;top:0;z-index:10;border-bottom:1px solid #1c1c1e;';

    // Compute month totals
    const allMonthItems = records.flatMap(r => Object.values(r.suppliers||{}).flat());
    const monthOrders = allMonthItems.filter(i => i.orderQty && i.orderQty !== '' && i.orderQty !== '0').length;
    const monthCrit = allMonthItems.filter(i => i.status === 'critical').length;

    monthHdr.innerHTML = `
      <div>
        <div style="font-family:ui-monospace,'SF Mono','Courier New',monospace;font-size:13px;font-weight:700;color:#f2f2f7;">${label}</div>
        <div style="font-family:ui-monospace,'SF Mono','Courier New',monospace;font-size:10px;color:#48484a;margin-top:1px;">${records.length} order${records.length>1?'s':''} ¬∑ ${monthOrders} items${monthCrit>0?' ¬∑ üî¥ '+monthCrit:''}</div>
      </div>
      <button onclick="openMonthReport('${key}')" style="
        padding:5px 12px;border-radius:12px;border:1.5px solid #3a3a3c;
        background:transparent;color:#a3a3a3;
        font-family:ui-monospace,'SF Mono','Courier New',monospace;font-size:10px;font-weight:700;
        cursor:pointer;letter-spacing:0.5px;">üìä REPORT</button>`;
    listEl.appendChild(monthHdr);

    // Records within this month
    records.forEach(rec => {
      const d = new Date(rec.date);
      const sups = Object.keys(rec.suppliers || {});
      const allItems = sups.flatMap(s => rec.suppliers[s]);
      const critCnt = allItems.filter(i => i.status === 'critical').length;
      const lowCnt  = allItems.filter(i => i.status === 'low').length;
      const ordCnt  = allItems.filter(i => i.orderQty && i.orderQty !== '').length;
      const hasNote = !!rec.globalNote || allItems.some(i => i.note);

      const row = document.createElement('div');
      row.className = 'hist-row';

      const mainBtn = document.createElement('button');
      mainBtn.className = 'hist-row-btn';
      mainBtn.onclick = () => { state.selectedRec = rec; renderDetail(rec); };

      const dateTile = `<div class="hist-date-tile">
        <span style="color:#ef4444;font-family:ui-monospace,'SF Mono','Courier New',monospace;font-size:9px;font-weight:700">${d.toLocaleDateString('en-US',{month:'short'}).toUpperCase()}</span>
        <span style="color:#f2f2f7;font-family:ui-monospace,'SF Mono','Courier New',monospace;font-size:22px;font-weight:800;line-height:1">${d.getDate()}</span>
        <span style="color:#636366;font-family:ui-monospace,'SF Mono','Courier New',monospace;font-size:9px">${d.toLocaleDateString('en-US',{weekday:'short'}).toUpperCase()}</span>
      </div>`;

      const badges = sups.slice(0,4).map(sn => `<span class="sup-badge" style="background:${state.catalog[sn]?.color||'#333'}">${sn.split(' ')[0]}</span>`).join('') +
        (sups.length > 4 ? `<span style="color:#48484a;font-size:10px">+${sups.length-4}</span>` : '');

      const stats = [
        ordCnt  > 0 ? `<span style="color:#f97316;font-family:ui-monospace,'SF Mono','Courier New',monospace;font-size:11px">üì¶ ${ordCnt}</span>` : '',
        critCnt > 0 ? `<span style="color:#f87171;font-family:ui-monospace,'SF Mono','Courier New',monospace;font-size:11px">üî¥ ${critCnt}</span>` : '',
        lowCnt  > 0 ? `<span style="color:#fbbf24;font-family:ui-monospace,'SF Mono','Courier New',monospace;font-size:11px">üü° ${lowCnt}</span>` : '',
        hasNote     ? `<span style="color:#d4a000;font-family:ui-monospace,'SF Mono','Courier New',monospace;font-size:11px">‚úé</span>` : '',
      ].filter(Boolean).join('');

      mainBtn.innerHTML = `${dateTile}
        <div style="flex:1;min-width:0">
          <div style="display:flex;gap:5px;flex-wrap:wrap;margin-bottom:5px">${badges}</div>
          <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center">${stats}</div>
          <div style="color:#3a3a3c;font-family:ui-monospace,'SF Mono','Courier New',monospace;font-size:10px;margin-top:3px">
            ${d.toLocaleTimeString('en-US',{hour:'2-digit',minute:'2-digit'})}
          </div>
        </div>
        <span style="color:#3a3a3c;font-size:22px">‚Ä∫</span>`;

      const printBtn = document.createElement('button');
      printBtn.className = 'hist-print-btn';
      printBtn.innerHTML = '<span>üñ®</span><span class="hist-print-label">PRINT</span>';
      printBtn.onclick = (e) => { e.stopPropagation(); openPrint(rec); };

      row.appendChild(mainBtn);
      row.appendChild(printBtn);
      listEl.appendChild(row);
    });
  });

  const spacer = document.createElement('div'); spacer.className = 'safe-bottom';
  listEl.appendChild(spacer);
}

function renderDetail(rec) {
  const detail = document.getElementById('hist-detail');
  detail.classList.add('show');

  const d = new Date(rec.date);
  const allItems = Object.values(rec.suppliers || {}).flat();
  const ordCnt = allItems.filter(i => i.orderQty && i.orderQty !== '').length;

  document.getElementById('detail-date').textContent =
    d.toLocaleDateString('en-US', {weekday:'long', month:'short', day:'numeric', year:'numeric'});
  document.getElementById('detail-meta').textContent =
    d.toLocaleTimeString('en-US', {hour:'2-digit', minute:'2-digit'}) + ' ¬∑ ' + ordCnt + ' items ordered';

  const printBtn = document.getElementById('btn-print-detail');
  printBtn.onclick = () => openPrint(rec);

  const scroll = document.getElementById('detail-scroll');
  scroll.innerHTML = '';

  if (rec.globalNote) {
    const noteBox = document.createElement('div');
    noteBox.style.cssText = 'margin:12px 16px;background:#1c1c1e;border:1.5px solid #3a3a3c;border-radius:14px;padding:12px 14px';
    noteBox.innerHTML = `<div style="color:#fbbf24;font-family:ui-monospace,'SF Mono','Courier New',monospace;font-size:10px;letter-spacing:1px;margin-bottom:6px">üìù ORDER NOTE</div>
      <div style="color:#e5e5e7;font-family:-apple-system, BlinkMacSystemFont, 'SF Pro Text', sans-serif;font-size:15px;line-height:1.5">${rec.globalNote}</div>`;
    scroll.appendChild(noteBox);
  }

  Object.entries(rec.suppliers).forEach(([sn, items]) => {
    const s = state.catalog[sn] || DEFAULT_SUPPLIERS[sn];
    const block = document.createElement('div');

    const header = document.createElement('div');
    header.className = 'detail-sup-header';
    header.style.background = s?.color || '#333';
    header.innerHTML = `<span style="color:#fff;font-family:ui-monospace,'SF Mono','Courier New',monospace;font-size:12px;font-weight:700">${sn}</span>
      <span style="color:rgba(255,255,255,0.45);font-family:ui-monospace,'SF Mono','Courier New',monospace;font-size:11px">${items.length} items</span>`;
    block.appendChild(header);

    items.forEach((item, idx) => {
      const itemEl = document.createElement('div');
      itemEl.className = 'detail-item' + (item.status === 'critical' ? ' critical' : item.status === 'low' ? ' low' : idx % 2 === 0 ? ' alt' : '');

      const row = document.createElement('div');
      row.style.cssText = 'display:flex;justify-content:space-between;align-items:flex-start;gap:8px';
      row.innerHTML = `
        <div style="flex:1;min-width:0">
          <div style="color:#e5e5e7;font-family:-apple-system, BlinkMacSystemFont, 'SF Pro Text', sans-serif;font-size:14px;line-height:1.3">${item.name}</div>
          <div style="color:#48484a;font-family:ui-monospace,'SF Mono','Courier New',monospace;font-size:11px;margin-top:2px">${item.pack} ¬∑ par ${item.par}</div>
        </div>
        <div class="detail-values">
          <div class="detail-val-col">
            <div class="detail-val-label">ON HAND</div>
            <div class="detail-val">${item.onHand || '‚Äî'}</div>
          </div>
          ${item.begin ? `<div class="detail-val-col">
            <div class="detail-val-label">BEGIN</div>
            <div class="detail-val" style="color:#a78bfa">${item.begin}</div>
          </div>` : ''}
          ${item.usage ? `<div class="detail-val-col">
            <div class="detail-val-label">USED</div>
            <div class="detail-val" style="color:#f87171">-${item.usage}</div>
          </div>` : ''}
          ${item.brkgCost ? `<div class="detail-val-col">
            <div class="detail-val-label">LOSS</div>
            <div class="detail-val" style="color:#f87171;font-size:12px">$${item.brkgCost}</div>
          </div>` : ''}
          <div class="detail-val-col">
            <div class="detail-val-label">ORDERED</div>
            <div class="detail-val ${item.orderQty ? 'ordered' : 'empty'}">${item.orderQty || '‚Äî'}</div>
          </div>
          ${item.status ? `<span style="font-size:18px">${STATUS_ICONS[item.status]}</span>` : ''}
        </div>`;
      itemEl.appendChild(row);

      if (item.note) {
        const noteEl = document.createElement('div');
        noteEl.className = 'item-note-box';
        noteEl.textContent = '"' + item.note + '"';
        itemEl.appendChild(noteEl);
      }
      block.appendChild(itemEl);
    });

    scroll.appendChild(block);
  });

  const spacer = document.createElement('div'); spacer.className = 'safe-bottom';
  scroll.appendChild(spacer);
}

function closeDetail() {
  document.getElementById('hist-detail').classList.remove('show');
  state.selectedRec = null;
}

// ‚îÄ‚îÄ‚îÄ EDIT MODE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function toggleEditMode() {
  state.editMode = !state.editMode;
  state.editingItem = null;
  render();
}

function startEdit(sn, item) {
  state.editingItem = {sn, id: item.id};
  document.getElementById('edit-sheet-sup').textContent = sn;
  document.getElementById('edit-name').value = item.name;
  document.getElementById('edit-pack').value = item.pack;
  document.getElementById('edit-par').value = item.par;
  document.getElementById('edit-sheet').style.display = 'flex';
  setTimeout(() => document.getElementById('edit-name').focus(), 100);
}

function cancelEdit() {
  state.editingItem = null;
  document.getElementById('edit-sheet').style.display = 'none';
}

function commitEdit() {
  if (!state.editingItem) return;
  const {sn, id} = state.editingItem;
  const name = document.getElementById('edit-name').value.trim();
  const pack = document.getElementById('edit-pack').value.trim();
  const par  = parseFloat(document.getElementById('edit-par').value);

  state.catalog[sn].items = state.catalog[sn].items.map(it =>
    it.id === id ? {...it, name: name||it.name, pack: pack||it.pack, par: isNaN(par) ? it.par : par} : it
  );
  saveCatalog();
  cancelEdit();
  showToast('‚úì Item updated');
  render();
}

// ‚îÄ‚îÄ‚îÄ SAVE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function openSaveModal() { document.getElementById('save-modal').style.display = 'flex'; }
function closeSaveModal() { document.getElementById('save-modal').style.display = 'none'; }

function doSave() {
  const btn = document.getElementById('btn-confirm-save');
  btn.textContent = 'SAVING‚Ä¶'; btn.disabled = true;

  const snap = { id: 'rec_' + Date.now(), date: new Date().toISOString(), globalNote: state.globalNote.trim(), suppliers: {} };
  for (const [sn, s] of Object.entries(state.catalog)) {
    const items = s.items.reduce((acc, it) => {
      const oh = state.onHand[ikey(sn, it.id)] ?? '';
      const oq = state.orderQty[ikey(sn, it.id)] ?? '';
      const nt = state.itemNotes[ikey(sn, it.id)] ?? '';
      const brk = sn === 'TRIMARK' ? (state.breakage[it.id] ?? '') : '';
      const beg = sn === 'TRIMARK' ? (state.trimarkBegin[it.id] ?? '') : '';
      const begV = parseFloat(beg), ohV = parseFloat(oh);
      const usageCalc = sn === 'TRIMARK' && beg !== '' && oh !== '' && !isNaN(begV) && !isNaN(ohV) ? String(Math.max(0, begV - ohV)) : '';
      if (oh !== '' || oq !== '' || nt !== '') {
        acc.push({name:it.name, pack:it.pack, par:it.par, onHand:oh, orderQty:oq, note:nt, status:getStatus(oh, it.par),
          ...(brk !== '' && brk !== '0' ? {breakage: brk} : {}),
          ...(beg !== '' ? {begin:beg} : {}),
          ...(usageCalc !== '' && usageCalc !== '0' ? {usage:usageCalc} : {}),
          ...(it.unitCost && usageCalc !== '' ? {brkgCost:(parseFloat(usageCalc)*it.unitCost).toFixed(2)} : {})});
      }
      return acc;
    }, []);
    if (items.length) snap.suppliers[sn] = items;
  }

  const hasData = Object.keys(snap.suppliers).length > 0 || snap.globalNote;
  if (!hasData) {
    showToast('Nothing entered yet.', 'warn');
    btn.textContent = '‚úì  CONFIRM SAVE & RESET'; btn.disabled = false;
    closeSaveModal(); return;
  }

  state.history = [snap, ...state.history].slice(0, 365);
  lsSet('bartletts-orders-v3', state.history);
  fbSaveRecord(snap); // sync to Firebase

  // Reset
  // For Trimark: carry ending counts forward as next month's beginning
  const triItems = state.catalog['TRIMARK']?.items || [];
  const newBegin = {};
  triItems.forEach(it => {
    const ik = ikey('TRIMARK', it.id);
    const endVal = state.onHand[ik];
    if (endVal !== undefined && endVal !== '') newBegin[it.id] = endVal;
  });
  state.trimarkBegin = newBegin;
  saveTrimarkBegin();
  state.trimarkTally = {};
  saveTrimarkTally();

  state.onHand = {}; state.orderQty = {};
  state.itemNotes = {}; state.globalNote = ''; state._openNote = null;
  state.breakage = {}; saveBreakage();
  state.trimarkView = 'order';

  btn.textContent = '‚úì  CONFIRM SAVE & RESET'; btn.disabled = false;
  closeSaveModal();

  // If ABCO had items ordered, show SMS button
  const abcoItems = snap.suppliers['ABCO'] || [];
  const abcoOrdered = abcoItems.filter(i => i.orderQty && i.orderQty !== '' && i.orderQty !== '0');
  if (abcoOrdered.length > 0) {
    showToast('‚úì Saved & reset!');
    render();
    // Show SMS prompt after a short delay
    setTimeout(() => showAbcoSmsPrompt(abcoOrdered), 600);
  } else {
    showToast('‚úì Saved & reset!');
    render();
  }
}

function showAbcoSmsPrompt(items) {
  const existing = document.getElementById('abco-sms-prompt');
  if (existing) existing.remove();

  const el = document.createElement('div');
  el.id = 'abco-sms-prompt';
  el.style.cssText = `
    position:fixed;bottom:calc(72px + env(safe-area-inset-bottom));left:50%;transform:translateX(-50%);
    background:#1c1c1e;border:1.5px solid #3a3a3c;border-radius:16px;
    padding:14px 18px;display:flex;align-items:center;gap:12px;
    box-shadow:0 8px 32px rgba(0,0,0,0.6);z-index:9999;
    font-family:ui-monospace,'SF Mono','Courier New',monospace;
    max-width:calc(100vw - 32px);
  `;
  el.innerHTML = `
    <div style="font-size:11px;color:#a3a3a3;line-height:1.4;">
      <div style="color:#e5e5e7;font-weight:700;font-size:12px;margin-bottom:2px;">üì± Text Hal?</div>
      ${items.length} item${items.length > 1 ? 's' : ''} to order from ABCO
    </div>
    <button onclick="openAbcoSms()" style="
      flex-shrink:0;height:38px;padding:0 16px;border-radius:19px;
      background:#ef4444;border:none;color:#fff;
      font-family:ui-monospace,'SF Mono','Courier New',monospace;font-size:11px;font-weight:700;
      cursor:pointer;letter-spacing:0.5px;">
      OPEN SMS
    </button>
    <button onclick="document.getElementById('abco-sms-prompt').remove()" style="
      flex-shrink:0;width:28px;height:28px;border-radius:14px;
      background:#2c2c2e;border:none;color:#636366;font-size:16px;
      cursor:pointer;display:flex;align-items:center;justify-content:center;">√ó</button>
  `;
  document.body.appendChild(el);

  // Store items for when button is pressed
  el._items = items;

  // Auto-dismiss after 12 seconds
  setTimeout(() => { if (el.parentNode) el.remove(); }, 12000);
}

function openAbcoSms() {
  const el = document.getElementById('abco-sms-prompt');
  const items = el?._items || [];
  el?.remove();

  const lines = items.map(i => `${i.name} x${i.orderQty}`).join('\n');
  const body = `Hi Hal, ABCO order:\n\n${lines}\n\nThanks`;
  const encoded = encodeURIComponent(body);
  window.location.href = `sms:5128015422&body=${encoded}`;
}

// ‚îÄ‚îÄ‚îÄ MONTH REPORT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function openMonthReport(monthKey) {
  const [year, month] = monthKey.split('-').map(Number);
  const records = state.history.filter(r => {
    const d = new Date(r.date);
    return d.getFullYear() === year && d.getMonth()+1 === month;
  });
  if (!records.length) return;

  const monthLabel = new Date(year, month-1, 1).toLocaleDateString('en-US', {month:'long', year:'numeric'});

  // Aggregate all items across all orders this month
  const itemTotals = {}; // "SUP|name" ‚Üí {name, pack, sup, totalOrdered, orderCount, critCount}
  records.forEach(rec => {
    Object.entries(rec.suppliers||{}).forEach(([sn, items]) => {
      items.forEach(it => {
        const k = sn + '|' + it.name;
        if (!itemTotals[k]) itemTotals[k] = {name:it.name, pack:it.pack||'', sup:sn, totalOrdered:0, orderCount:0, critCount:0, lowCount:0};
        const qty = parseFloat(it.orderQty) || 0;
        if (qty > 0) { itemTotals[k].totalOrdered += qty; itemTotals[k].orderCount++; }
        if (it.status === 'critical') itemTotals[k].critCount++;
        if (it.status === 'low') itemTotals[k].lowCount++;
      });
    });
  });

  // Group by supplier
  const bySup = {};
  Object.values(itemTotals).forEach(it => {
    if (!bySup[it.sup]) bySup[it.sup] = [];
    bySup[it.sup].push(it);
  });

  const totalOrders = records.length;
  const totalItemsOrdered = Object.values(itemTotals).filter(i => i.totalOrdered > 0).length;

  let supBlocks = Object.entries(bySup).map(([sn, items]) => {
    const sup = state.catalog[sn] || DEFAULT_SUPPLIERS[sn];
    const rows = items.sort((a,b) => b.totalOrdered - a.totalOrdered).map(it => `
      <tr style="border-bottom:1px solid #f3f4f6;">
        <td style="padding:8px 10px;font-size:13px;">${it.name}</td>
        <td style="padding:8px 10px;font-size:11px;color:#6b7280;">${it.pack}</td>
        <td style="padding:8px 10px;text-align:center;font-weight:700;font-size:14px;color:${it.totalOrdered>0?'#111':'#9ca3af'}">${it.totalOrdered || '‚Äî'}</td>
        <td style="padding:8px 10px;text-align:center;font-size:12px;color:#6b7280;">${it.orderCount>0?it.orderCount+'x':'‚Äî'}</td>
        <td style="padding:8px 10px;text-align:center;font-size:12px;">${it.critCount>0?'üî¥ '+it.critCount:it.lowCount>0?'üü° '+it.lowCount:'‚Äî'}</td>
      </tr>`).join('');
    return `
      <div style="margin-bottom:28px;">
        <div style="background:${sup.color||'#1e293b'};color:#fff;padding:8px 14px;border-radius:8px 8px 0 0;font-family:monospace;font-size:13px;font-weight:700;letter-spacing:1px;">${sn}</div>
        <table style="width:100%;border-collapse:collapse;background:#fff;border-radius:0 0 8px 8px;overflow:hidden;box-shadow:0 1px 4px rgba(0,0,0,0.08);">
          <thead><tr style="background:#f9fafb;border-bottom:2px solid #e5e7eb;">
            <th style="padding:8px 10px;text-align:left;font-size:10px;color:#6b7280;font-family:monospace;letter-spacing:1px;">ITEM</th>
            <th style="padding:8px 10px;text-align:left;font-size:10px;color:#6b7280;font-family:monospace;letter-spacing:1px;">PACK</th>
            <th style="padding:8px 10px;text-align:center;font-size:10px;color:#6b7280;font-family:monospace;letter-spacing:1px;">TOTAL QTY</th>
            <th style="padding:8px 10px;text-align:center;font-size:10px;color:#6b7280;font-family:monospace;letter-spacing:1px;">ORDERS</th>
            <th style="padding:8px 10px;text-align:center;font-size:10px;color:#6b7280;font-family:monospace;letter-spacing:1px;">ALERTS</th>
          </tr></thead>
          <tbody>${rows}</tbody>
        </table>
      </div>`;
  }).join('');

  const html = `<!DOCTYPE html><html><head><meta charset="UTF-8">
    <title>Monthly Report ‚Äî ${monthLabel}</title>
    <style>
      body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background:#f8fafc; color:#111; margin:0; padding:24px; }
      @media print { body { padding:12px; } button { display:none; } }
    </style>
  </head><body>
  <button onclick="window.print()" style="margin-bottom:20px;padding:8px 20px;background:#ef4444;color:#fff;border:none;border-radius:8px;font-weight:700;cursor:pointer;font-size:13px;">üñ® Print Report</button>
  <div style="border-bottom:3px solid #ef4444;padding-bottom:16px;margin-bottom:24px;">
    <div style="font-size:24px;font-weight:800;color:#ef4444;letter-spacing:2px;font-family:monospace;">BARTLETT'S</div>
    <div style="font-size:14px;color:#6b7280;letter-spacing:1px;font-family:monospace;margin-top:2px;">MONTHLY ORDER REPORT</div>
    <div style="font-size:20px;font-weight:700;margin-top:8px;">${monthLabel}</div>
    <div style="display:flex;gap:16px;margin-top:14px;flex-wrap:wrap;">
      <div style="background:#fff;border:1px solid #e5e7eb;border-radius:8px;padding:10px 16px;text-align:center;">
        <div style="font-size:22px;font-weight:800;color:#111;font-family:monospace;">${totalOrders}</div>
        <div style="font-size:10px;color:#6b7280;font-family:monospace;">ORDERS PLACED</div>
      </div>
      <div style="background:#fff;border:1px solid #e5e7eb;border-radius:8px;padding:10px 16px;text-align:center;">
        <div style="font-size:22px;font-weight:800;color:#f97316;font-family:monospace;">${totalItemsOrdered}</div>
        <div style="font-size:10px;color:#6b7280;font-family:monospace;">ITEMS ORDERED</div>
      </div>
      <div style="background:#fff;border:1px solid #e5e7eb;border-radius:8px;padding:10px 16px;text-align:center;">
        <div style="font-size:22px;font-weight:800;color:#111;font-family:monospace;">${Object.keys(bySup).length}</div>
        <div style="font-size:10px;color:#6b7280;font-family:monospace;">SUPPLIERS</div>
      </div>
    </div>
  </div>
  ${supBlocks}
  <div style="margin-top:24px;padding-top:12px;border-top:1px solid #e5e7eb;display:flex;justify-content:space-between;font-size:10px;color:#9ca3af;font-family:monospace;flex-wrap:wrap;gap:8px;">
    <span>¬© 2025 Oscar Rivas ¬∑ Bartlett's Restaurant ¬∑ All rights reserved</span>
    <span>Generated: ${new Date().toLocaleString('en-US')}</span>
  </div>
  </body></html>`;

  const blob = new Blob([html], {type:'text/html'});
  const url = URL.createObjectURL(blob);
  const w = window.open(url, '_blank');
  setTimeout(() => URL.revokeObjectURL(url), 10000);
}


function openPrint(rec) {
  const d = new Date(rec.date);
  const dateStr = d.toLocaleDateString('en-US', {weekday:'long', year:'numeric', month:'long', day:'numeric'});
  const timeStr = d.toLocaleTimeString('en-US', {hour:'2-digit', minute:'2-digit'});
  const allItems = Object.values(rec.suppliers||{}).flat();
  const orderedItems = allItems.filter(i => i.orderQty && i.orderQty !== '');
  const critItems = allItems.filter(i => i.status === 'critical');
  const lowItems  = allItems.filter(i => i.status === 'low');

  const supBlocks = Object.entries(rec.suppliers||{}).map(([sn, items]) => {
    const sup = state.catalog[sn]||DEFAULT_SUPPLIERS[sn];
    const ordered = items.filter(i => i.orderQty && i.orderQty !== '');
    if (!ordered.length) return '';
    const rows = ordered.map((item,idx) => {
      const sc = item.status==='critical'?'#dc2626':item.status==='low'?'#d97706':'#16a34a';
      const sl = item.status==='critical'?'‚ö† ASAP':item.status==='low'?'‚Üì Low':'‚úì OK';
      const bg = idx%2===0?'#f9fafb':'#fff';
      const begCell = sn==='TRIMARK' ? `<td style="padding:8px 10px;font-size:12px;color:#a78bfa;border-bottom:1px solid #e5e7eb;text-align:center">${item.begin||'‚Äî'}</td>` : '';
      const usedCell = sn==='TRIMARK' ? `<td style="padding:8px 10px;font-size:12px;font-weight:700;color:#f87171;border-bottom:1px solid #e5e7eb;text-align:center">${item.usage?'-'+item.usage:'‚Äî'}</td>` : '';
      const lossCell = sn==='TRIMARK' ? `<td style="padding:8px 10px;font-size:12px;color:#f87171;border-bottom:1px solid #e5e7eb;text-align:center">${item.brkgCost?'$'+item.brkgCost:'‚Äî'}</td>` : '';
      const triColspan = sn==='TRIMARK' ? 8 : 5;
      return `<tr style="background:${bg}">
        <td style="padding:8px 10px;font-size:13px;border-bottom:1px solid #e5e7eb">${item.name}</td>
        <td style="padding:8px 10px;font-size:12px;color:#6b7280;border-bottom:1px solid #e5e7eb;text-align:center">${item.pack}</td>
        ${begCell}${usedCell}${lossCell}
        <td style="padding:8px 10px;font-size:12px;color:#6b7280;border-bottom:1px solid #e5e7eb;text-align:center">${item.onHand||'‚Äî'}</td>
        <td style="padding:8px 10px;font-size:13px;font-weight:700;border-bottom:1px solid #e5e7eb;text-align:center">${item.orderQty}</td>
        <td style="padding:8px 10px;font-size:11px;font-weight:700;color:${sc};border-bottom:1px solid #e5e7eb;text-align:center">${sl}</td>
      </tr>${item.note?`<tr style="background:${bg}"><td colspan="${triColspan}" style="padding:2px 10px 8px;font-size:11px;color:#92400e;font-style:italic;border-bottom:1px solid #e5e7eb">‚Ü≥ ${item.note}</td></tr>`:''}`
    }).join('');
    const hasBrkCol = sn === 'TRIMARK';
    return `<div style="margin-bottom:24px;break-inside:avoid">
      <div style="background:${sup?.color||'#333'};color:#fff;padding:10px 14px;border-radius:8px 8px 0 0;display:flex;justify-content:space-between">
        <span style="font-family:monospace;font-size:14px;font-weight:700;letter-spacing:1px">${sn}</span>
        <span style="font-size:11px;opacity:0.7">${ordered.length} item${ordered.length!==1?'s':''} ordered</span>
      </div>
      <table style="width:100%;border-collapse:collapse;border:1px solid #e5e7eb;border-top:none">
        <thead><tr style="background:#f3f4f6">
          <th style="padding:7px 10px;font-size:10px;color:#6b7280;text-align:left;font-family:monospace;border-bottom:2px solid #e5e7eb">ITEM</th>
          <th style="padding:7px 10px;font-size:10px;color:#6b7280;text-align:center;font-family:monospace;border-bottom:2px solid #e5e7eb">PACK</th>
          ${hasBrkCol?'<th style="padding:7px 10px;font-size:10px;color:#a78bfa;text-align:center;font-family:monospace;border-bottom:2px solid #e5e7eb">BEGIN</th><th style="padding:7px 10px;font-size:10px;color:#f87171;text-align:center;font-family:monospace;border-bottom:2px solid #e5e7eb">USED</th><th style="padding:7px 10px;font-size:10px;color:#f87171;text-align:center;font-family:monospace;border-bottom:2px solid #e5e7eb">LOSS $</th>':''}
          <th style="padding:7px 10px;font-size:10px;color:#6b7280;text-align:center;font-family:monospace;border-bottom:2px solid #e5e7eb">ENDING</th>
          <th style="padding:7px 10px;font-size:10px;color:#6b7280;text-align:center;font-family:monospace;border-bottom:2px solid #e5e7eb">ORDER QTY</th>
          <th style="padding:7px 10px;font-size:10px;color:#6b7280;text-align:center;font-family:monospace;border-bottom:2px solid #e5e7eb">STATUS</th>
        </tr></thead>
        <tbody>${rows}</tbody>
      </table></div>`;
  }).join('');

  const alertSec = (critItems.length||lowItems.length) ? `<div style="margin-bottom:24px;padding:14px 16px;background:#fff7ed;border:2px solid #fed7aa;border-radius:10px;break-inside:avoid">
    <div style="font-family:monospace;font-size:11px;font-weight:700;color:#92400e;letter-spacing:1px;margin-bottom:10px">‚ö† ATTENTION REQUIRED</div>
    ${critItems.length?`<div style="margin-bottom:8px"><div style="font-size:11px;font-weight:700;color:#dc2626;margin-bottom:4px">üî¥ CRITICAL (${critItems.length})</div>${critItems.map(i=>`<div style="font-size:12px;color:#7f1d1d;padding:2px 0 2px 12px">‚Ä¢ ${i.name} ‚Äî on hand: ${i.onHand||'0'}</div>`).join('')}</div>`:''}
    ${lowItems.length?`<div><div style="font-size:11px;font-weight:700;color:#d97706;margin-bottom:4px">üü° LOW STOCK (${lowItems.length})</div>${lowItems.map(i=>`<div style="font-size:12px;color:#78350f;padding:2px 0 2px 12px">‚Ä¢ ${i.name} ‚Äî on hand: ${i.onHand||'0'} / par ${i.par}</div>`).join('')}</div>`:''}
  </div>` : '';

  const noteSec = rec.globalNote ? `<div style="margin-bottom:24px;padding:14px 16px;background:#fefce8;border:2px solid #fde68a;border-radius:10px;break-inside:avoid">
    <div style="font-family:monospace;font-size:11px;font-weight:700;color:#92400e;letter-spacing:1px;margin-bottom:8px">üìù ORDER NOTES</div>
    <div style="font-size:13px;color:#1c1917;line-height:1.6">${rec.globalNote}</div>
  </div>` : '';

  const html = `<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Bartlett's Order ‚Äî ${dateStr}</title>
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;background:#fff;color:#111;padding:24px;max-width:780px;margin:0 auto}
    @media print{body{padding:0}.no-print{display:none!important}@page{margin:1.5cm;size:A4}}
  </style></head><body>
  <div class="no-print" style="text-align:right;margin-bottom:20px">
    <button onclick="window.print()" style="padding:10px 24px;background:#16a34a;color:#fff;border:none;border-radius:10px;font-size:13px;font-weight:700;cursor:pointer">üñ® Print / Save PDF</button>
    <button onclick="window.close()" style="padding:10px 20px;background:#f3f4f6;color:#374151;border:none;border-radius:10px;font-size:13px;font-weight:700;cursor:pointer;margin-left:8px">‚úï Close</button>
  </div>
  <div style="border-bottom:3px solid #16a34a;padding-bottom:16px;margin-bottom:24px">
    <div style="display:flex;justify-content:space-between;align-items:flex-start;flex-wrap:wrap;gap:12px">
      <div><div style="font-size:22px;font-weight:700;color:#ef4444;letter-spacing:2px;font-family:monospace">BARTLETT'S</div>
      <div style="font-size:11px;color:#6b7280;letter-spacing:2px;margin-top:2px;font-family:monospace">ORDER SUMMARY</div></div>
      <div style="text-align:right"><div style="font-size:16px;font-weight:700">${dateStr}</div><div style="font-size:12px;color:#6b7280;margin-top:2px">Placed at ${timeStr}</div></div>
    </div>
    <div style="display:flex;gap:16px;margin-top:16px;flex-wrap:wrap">
      <div style="background:#f0fdf4;border:1px solid #bbf7d0;border-radius:8px;padding:8px 14px;text-align:center"><div style="font-size:18px;font-weight:700;color:#16a34a;font-family:monospace">${orderedItems.length}</div><div style="font-size:10px;color:#6b7280;font-family:monospace">ITEMS ORDERED</div></div>
      <div style="background:#f0fdf4;border:1px solid #bbf7d0;border-radius:8px;padding:8px 14px;text-align:center"><div style="font-size:18px;font-weight:700;color:#16a34a;font-family:monospace">${Object.keys(rec.suppliers||{}).length}</div><div style="font-size:10px;color:#6b7280;font-family:monospace">SUPPLIERS</div></div>
      ${critItems.length?`<div style="background:#fef2f2;border:1px solid #fecaca;border-radius:8px;padding:8px 14px;text-align:center"><div style="font-size:18px;font-weight:700;color:#dc2626;font-family:monospace">${critItems.length}</div><div style="font-size:10px;color:#6b7280;font-family:monospace">CRITICAL</div></div>`:''}
      ${lowItems.length?`<div style="background:#fffbeb;border:1px solid #fde68a;border-radius:8px;padding:8px 14px;text-align:center"><div style="font-size:18px;font-weight:700;color:#d97706;font-family:monospace">${lowItems.length}</div><div style="font-size:10px;color:#6b7280;font-family:monospace">LOW STOCK</div></div>`:''}
    </div>
  </div>
  ${alertSec}${noteSec}${supBlocks}
  <div style="margin-top:32px;padding-top:14px;border-top:1px solid #e5e7eb;display:flex;justify-content:space-between;flex-wrap:wrap;gap:8px">
    <div style="font-size:10px;color:#9ca3af;font-family:monospace">¬© 2025 Oscar Rivas ¬∑ Bartlett's Restaurant ¬∑ All rights reserved</div>
    <div style="font-size:10px;color:#9ca3af;font-family:monospace">Printed: ${new Date().toLocaleString('en-US')}</div>
  </div></body></html>`;

  const blob = new Blob([html], {type:'text/html'});
  const url = URL.createObjectURL(blob);
  const w = window.open(url, '_blank');
  if (!w) {
    const a = document.createElement('a');
    a.href=url; a.target='_blank'; a.rel='noopener';
    document.body.appendChild(a); a.click(); document.body.removeChild(a);
  }
  setTimeout(() => URL.revokeObjectURL(url), 60000);
}

// ‚îÄ‚îÄ‚îÄ MUST KNOW DATA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const MUST_KNOW = [
  {
    supplier: 'üí° HOW TO USE THIS APP',
    color: '#1c1917', accent: '#a8a29e',
    isGeneral: true,
    notes: [
      '1Ô∏è‚É£ Enter ON HAND counts for every item you check',
      '2Ô∏è‚É£ ORDER qty auto-fills (par minus on hand) ‚Äî adjust if needed',
      '3Ô∏è‚É£ Add item notes with ‚úé for anything staff should know',
      '4Ô∏è‚É£ Tap ‚úé EDIT in top bar to update item names, pack sizes, or pars',
      '5Ô∏è‚É£ Hit üíæ SAVE when done ‚Äî this locks the order to history',
      '6Ô∏è‚É£ Print from History tab to post for the team',
    ]
  },
  {
    supplier: 'üî¥ CRITICAL RULES',
    color: '#450a0a', accent: '#f87171',
    isGeneral: true,
    notes: [
      'üî¥ CRITICAL = on hand is 0 or below ‚Äî order immediately, same day',
      'üü° LOW = on hand is below par ‚Äî order on next scheduled delivery',
      '‚úÖ Par levels are the MINIMUM we need to have at all times',
      'üìä When in doubt, order more ‚Äî running out costs more than overstock',
      'üóìÔ∏è Check order history before placing ‚Äî avoid duplicate orders',
      'üñ®Ô∏è Print the order summary and post it so all staff know what\'s coming',
    ]
  },
  {
    supplier: 'ABCO',
    color: '#1e4d35', accent: '#4ade80',
    contact: 'Hal Nouvealty',
    phone: '512-801-5422',
    method: 'SMS',
    cutoffs: [
      { day: 'Same day',  time: 'before 10:30 AM', delivery: 'Same day ‚ö°' },
      { day: 'Sunday',    time: 'before 3:00 PM', delivery: 'Monday' },
      { day: 'Wednesday', time: 'before 3:00 PM', delivery: 'Thursday' },
      { day: 'Thursday',  time: 'before 3:00 PM', delivery: 'Friday (optional)' },
    ],
    notes: [
      '‚ö° Same-day delivery available ‚Äî text Hal before 10:30 AM',
      'üì¶ Minimum order may apply ‚Äî confirm with Hal if ordering small quantities',
      'üì± TEXT orders only ‚Äî do not call',
      'üîÑ Check Bio Pak stock carefully ‚Äî both sizes run out fast on weekends',
    ]
  },
  {
    supplier: 'BEK',
    color: '#0f172a', accent: '#60a5fa',
    contact: 'Online Portal',
    phone: 'BekEntree.com',
    method: 'Web',
    cutoffs: [
      { day: 'Sunday',    time: 'before 4:00 PM', delivery: 'Monday' },
      { day: 'Wednesday', time: 'before 4:00 PM', delivery: 'Thursday' },
      { day: 'Friday',    time: 'before 4:00 PM', delivery: 'Saturday' },
    ],
    notes: [
      'üíª Login: Bartletts@bartlettsaustin.com ¬∑ Burnet2808!',
      'üß§ Gloves are high-velocity ‚Äî check both Poly and Nitrile weekly',
      'üßª Paper goods (towels, TP, Z-fold) ‚Äî order before you think you need to',
      'üè∑Ô∏è Day dots: keep all 7 days stocked. Running out = labeling stops.',
      'üõ¢Ô∏è FRYER OIL ‚Äî order from BEK. Par is 10 cases.',
      'üóìÔ∏è Oil dump days are Wednesday & Thursday ‚Äî always have stock before then',
      '‚ö†Ô∏è Never let oil drop below 3 cases ‚Äî running out mid-service is not an option',
      'üìÖ Order oil on Sunday or Monday delivery to be stocked before Wed dump',
      '‚ö†Ô∏è Confirm delivery windows around holidays ‚Äî schedule changes',
    ]
  },
  {
    supplier: 'AMAZON',
    color: '#7c2d12', accent: '#fb923c',
    contact: 'Amazon Business',
    phone: 'bartletts@bartlettsaustin.com',
    method: 'Web',
    cutoffs: [
      { day: 'Any day', time: 'As needed', delivery: '1‚Äì2 business days (Prime)' },
    ],
    notes: [
      'üîë Login: bartletts@bartlettsaustin.com ¬∑ 2408Anderson!',
      'ü™ë High chairs: keep 6 on floor minimum ‚Äî order before dropping below 5',
      'ü©π Blue bandaids & finger cots are health code items ‚Äî never run out',
      'ü™• Dental floss picks refill at host stand monthly',
      'ü´ô Check soap dispensers quarterly for breakage',
      'üì¶ Bundle small orders to avoid multiple deliveries ‚Äî check weekly',
    ]
  },
  {
    supplier: 'TRIMARK',
    color: '#3b0764', accent: '#c084fc',
    contact: 'James Hawley',
    phone: 'James.Hawley@trimarkusa.com',
    method: 'Email',
    cutoffs: [
      { day: 'Monthly', time: 'After inventory count', delivery: 'Varies ‚Äî confirm with James' },
    ],
    notes: [
      'üìß Always email James directly ‚Äî do not order through portal alone',
      'üç∑ Wine & champagne glasses break fastest ‚Äî count weekly during service',
      'üçΩÔ∏è Ala plates & salad plates are high volume ‚Äî maintain full par',
      'ü•Ñ Silverware (fork/knife/spoon) counts should happen every inventory',
      '‚è±Ô∏è Lead time can be 1‚Äì2 weeks ‚Äî never wait until you\'re out',
      'üìã After inventory: pull counts, compare to par, send one combined order',
      'üíú Tip plates: 250 par ‚Äî guests take them, losses are normal',
    ]
  },
];

function renderMustKnow() {
  document.getElementById('view-order').style.display = 'none';
  document.getElementById('view-history').style.display = 'none';
  document.getElementById('view-mustknow').style.display = 'flex';

  const scroll = document.getElementById('mustknow-scroll');
  scroll.innerHTML = '';

  // Header
  const hdr = document.createElement('div');
  hdr.style.cssText = 'padding:16px 16px 8px;';
  hdr.innerHTML = `<div style="font-family:ui-monospace,'SF Mono','Courier New',monospace;font-size:11px;color:#636366;letter-spacing:1.5px;margin-bottom:2px">QUICK REFERENCE</div>
    <div style="font-family:ui-monospace,'SF Mono','Courier New',monospace;font-size:18px;font-weight:700;color:#f2f2f7">Must Know</div>`;
  scroll.appendChild(hdr);

  MUST_KNOW.forEach(section => {
    const card = document.createElement('div');
    card.style.cssText = 'margin:8px 16px;border-radius:16px;overflow:hidden;';

    // Card header
    const cardHdr = document.createElement('div');
    cardHdr.style.cssText = `background:${section.color};padding:12px 16px;display:flex;align-items:center;justify-content:space-between;gap:10px;`;

    if (!section.isGeneral) {
      cardHdr.innerHTML = `
        <div>
          <div style="font-family:ui-monospace,'SF Mono','Courier New',monospace;font-size:14px;font-weight:700;color:#fff;letter-spacing:1px">${section.supplier}</div>
          <div style="font-family:ui-monospace,'SF Mono','Courier New',monospace;font-size:10px;color:rgba(255,255,255,0.5);margin-top:2px">${section.method} ¬∑ ${section.phone}</div>
        </div>
        <div style="text-align:right">
          <div style="color:${section.accent};font-family:ui-monospace,'SF Mono','Courier New',monospace;font-size:10px;font-weight:700;letter-spacing:0.5px">CONTACT</div>
          <div style="color:#fff;font-family:-apple-system, BlinkMacSystemFont, 'SF Pro Text', sans-serif;font-size:12px;margin-top:1px">${section.contact}</div>
        </div>`;
    } else {
      cardHdr.innerHTML = `<div style="font-family:ui-monospace,'SF Mono','Courier New',monospace;font-size:13px;font-weight:700;color:#fff">${section.supplier}</div>`;
    }
    card.appendChild(cardHdr);

    // Cutoffs
    if (section.cutoffs) {
      const cutoffBlock = document.createElement('div');
      cutoffBlock.style.cssText = `background:${section.color};opacity:0.85;padding:0 16px 10px;`;
      cutoffBlock.style.background = section.color;
      cutoffBlock.style.filter = 'brightness(1.15)';

      section.cutoffs.forEach(c => {
        const row = document.createElement('div');
        row.style.cssText = 'display:flex;align-items:center;justify-content:space-between;padding:5px 0;border-top:1px solid rgba(255,255,255,0.08);';
        row.innerHTML = `
          <div>
            <span style="color:${section.accent};font-family:ui-monospace,'SF Mono','Courier New',monospace;font-size:11px;font-weight:700">${c.day}</span>
            <span style="color:rgba(255,255,255,0.5);font-family:ui-monospace,'SF Mono','Courier New',monospace;font-size:10px;margin-left:8px">${c.time}</span>
          </div>
          <div style="color:rgba(255,255,255,0.6);font-family:ui-monospace,'SF Mono','Courier New',monospace;font-size:10px">‚Üí ${c.delivery}</div>`;
        cutoffBlock.appendChild(row);
      });

      // Add the cutoffBlock with matching color bg
      const cutoffWrap = document.createElement('div');
      cutoffWrap.style.cssText = `background:${section.color};padding:0 16px 10px;filter:brightness(1.12);`;
      section.cutoffs.forEach(c => {
        const row = document.createElement('div');
        row.style.cssText = 'display:flex;align-items:center;justify-content:space-between;padding:5px 0;border-top:1px solid rgba(255,255,255,0.08);';
        row.innerHTML = `
          <div>
            <span style="color:${section.accent};font-family:ui-monospace,'SF Mono','Courier New',monospace;font-size:11px;font-weight:700">${c.day}</span>
            <span style="color:rgba(255,255,255,0.5);font-family:ui-monospace,'SF Mono','Courier New',monospace;font-size:10px;margin-left:8px">${c.time}</span>
          </div>
          <div style="color:rgba(255,255,255,0.65);font-family:ui-monospace,'SF Mono','Courier New',monospace;font-size:10px">‚Üí ${c.delivery}</div>`;
        cutoffWrap.appendChild(row);
      });
      card.appendChild(cutoffWrap);
    }

    // Notes list
    const notesList = document.createElement('div');
    notesList.style.cssText = 'background:#111;';
    section.notes.forEach((note, idx) => {
      const noteEl = document.createElement('div');
      noteEl.style.cssText = `padding:11px 16px;border-top:1px solid #1c1c1e;font-family:-apple-system, BlinkMacSystemFont, 'SF Pro Text', sans-serif;font-size:14px;color:#e5e5e7;line-height:1.45;${idx === section.notes.length - 1 ? '' : ''}`;
      noteEl.textContent = note;
      notesList.appendChild(noteEl);
    });
    card.appendChild(notesList);

    scroll.appendChild(card);
  });

  const spacer = document.createElement('div'); spacer.className = 'safe-bottom';
  scroll.appendChild(spacer);
}

// ‚îÄ‚îÄ‚îÄ TABS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function switchTab(tab) {
  state.tab = tab;
  state.editMode = false;
  state.editingItem = null;
  state.selectedRec = null;
  state.trimarkView = 'order';
  // Hide all views
  document.getElementById('view-order').style.display = 'none';
  document.getElementById('view-history').style.display = 'none';
  document.getElementById('view-mustknow').style.display = 'none';
  document.getElementById('hist-detail').classList.remove('show');
  render();
}

// ‚îÄ‚îÄ‚îÄ INSTALL BANNER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function dismissInstall() {
  document.getElementById('install-banner').classList.remove('show');
  lsSet('bartletts-install-dismissed', true);
}

function checkInstallPrompt() {
  // Show only if: not dismissed, not standalone, on iOS Safari
  const dismissed = lsGet('bartletts-install-dismissed');
  if (dismissed) return;
  const isStandalone = window.navigator.standalone === true ||
    window.matchMedia('(display-mode: standalone)').matches;
  if (isStandalone) return;
  const isIOS = /iphone|ipad|ipod/i.test(navigator.userAgent);
  const isSafari = /safari/i.test(navigator.userAgent) && !/chrome/i.test(navigator.userAgent) && !/crios/i.test(navigator.userAgent);
  const isMac = /macintosh/i.test(navigator.userAgent);
  if (isIOS || isSafari || isMac) {
    setTimeout(() => document.getElementById('install-banner').classList.add('show'), 1500);
  }
}

// ‚îÄ‚îÄ‚îÄ LOCATION TALLY MODAL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let _tallyItemId = null;
let _tallyOnEndInput = null; // callback to update ending input

function openTallyModal(item, onConfirm) {
  _tallyItemId = item.id;
  _tallyOnEndInput = onConfirm;

  const tally = state.trimarkTally[item.id] || {};
  document.getElementById('tally-item-name').textContent = item.name;
  document.getElementById('tally-item-sub').textContent = 'par ' + item.par + (item.unitCost ? ' ¬∑ $' + item.unitCost.toFixed(2) + ' ea' : '');

  const dockInp = document.getElementById('tally-dock');
  const closetInp = document.getElementById('tally-closet');
  const restInp = document.getElementById('tally-restaurant');

  dockInp.value   = tally.dock   !== undefined ? tally.dock   : '';
  closetInp.value = tally.closet !== undefined ? tally.closet : '';
  restInp.value   = tally.restaurant !== undefined ? tally.restaurant : '';

  updateTallyTotal();

  document.getElementById('tally-modal').style.display = 'flex';
  // Focus first empty field
  setTimeout(() => {
    if (!dockInp.value) dockInp.focus();
    else if (!closetInp.value) closetInp.focus();
    else restInp.focus();
  }, 100);
}

function updateTallyTotal() {
  const d = parseFloat(document.getElementById('tally-dock').value) || 0;
  const c = parseFloat(document.getElementById('tally-closet').value) || 0;
  const r = parseFloat(document.getElementById('tally-restaurant').value) || 0;
  const total = d + c + r;
  const el = document.getElementById('tally-total');
  el.textContent = total;
  el.style.color = total > 0 ? '#a78bfa' : '#48484a';
}

function closeTallyModal() {
  document.getElementById('tally-modal').style.display = 'none';
  _tallyItemId = null;
  _tallyOnEndInput = null;
}

function confirmTally() {
  const d = parseFloat(document.getElementById('tally-dock').value) || 0;
  const c = parseFloat(document.getElementById('tally-closet').value) || 0;
  const r = parseFloat(document.getElementById('tally-restaurant').value) || 0;
  const total = d + c + r;

  // Save location breakdown
  if (_tallyItemId) {
    state.trimarkTally[_tallyItemId] = { dock: d || '', closet: c || '', restaurant: r || '' };
    saveTrimarkTally();
  }

  // Callback updates the COUNT field and triggers row refresh
  if (_tallyOnEndInput) _tallyOnEndInput(String(total));
  closeTallyModal();
  showToast(`Count set: ${d} dock + ${c} closet + ${r} restaurant = ${total}`, 'ok');
}

// Live total update as user types
document.addEventListener('DOMContentLoaded', () => {
  ['tally-dock','tally-closet','tally-restaurant'].forEach(id => {
    document.getElementById(id).addEventListener('input', updateTallyTotal);
  });
});

// ‚îÄ‚îÄ‚îÄ PIN LOCK ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const PIN_HASH_KEY = 'bartletts-pin-hash-v1';
const PIN_SESSION_KEY = 'bartletts-pin-session';
const DEFAULT_PIN = '2408'; // initial PIN ‚Äî user should change this

function hashPin(pin) {
  // Simple but sufficient hash for a 4-digit PIN
  let h = 0;
  const salt = 'bartletts-oscar-rivas-2025';
  const str = salt + pin + salt;
  for (let i = 0; i < str.length; i++) {
    h = ((h << 5) - h) + str.charCodeAt(i);
    h |= 0;
  }
  return String(h >>> 0);
}

let _pinEntry = '';
let _pinAttempts = 0;
let _pinLockUntil = 0;

function initPinLock() {
  // Check if already unlocked this session
  const session = sessionStorage.getItem(PIN_SESSION_KEY);
  if (session === 'unlocked') {
    document.getElementById('pin-screen').style.display = 'none';
    return;
  }
  // Ensure a PIN hash is stored ‚Äî first run uses default PIN
  if (!localStorage.getItem(PIN_HASH_KEY)) {
    localStorage.setItem(PIN_HASH_KEY, hashPin(DEFAULT_PIN));
  }
  document.getElementById('pin-screen').style.display = 'flex';
}

function pinPress(digit) {
  // Check if locked out
  if (Date.now() < _pinLockUntil) {
    const secs = Math.ceil((_pinLockUntil - Date.now()) / 1000);
    document.getElementById('pin-error').textContent = `Too many attempts. Wait ${secs}s`;
    return;
  }
  if (_pinEntry.length >= 4) return;
  _pinEntry += digit;
  updatePinDots();
  if (_pinEntry.length === 4) {
    setTimeout(checkPin, 120);
  }
}

function pinDel() {
  _pinEntry = _pinEntry.slice(0, -1);
  updatePinDots();
  document.getElementById('pin-error').textContent = '';
}

function updatePinDots() {
  document.querySelectorAll('.pin-dot').forEach((d, i) => {
    d.classList.toggle('filled', i < _pinEntry.length);
  });
}

function checkPin() {
  const stored = localStorage.getItem(PIN_HASH_KEY) || hashPin(DEFAULT_PIN);
  if (hashPin(_pinEntry) === stored) {
    // Correct
    _pinAttempts = 0;
    sessionStorage.setItem(PIN_SESSION_KEY, 'unlocked');
    const screen = document.getElementById('pin-screen');
    screen.style.transition = 'opacity 0.3s';
    screen.style.opacity = '0';
    setTimeout(() => screen.style.display = 'none', 300);
  } else {
    // Wrong
    _pinAttempts++;
    _pinEntry = '';
    updatePinDots();
    document.getElementById('pin-error').textContent = `Incorrect PIN (${_pinAttempts}/5)`;
    // Shake animation
    const dots = document.getElementById('pin-dots');
    dots.style.animation = 'none';
    dots.offsetHeight; // reflow
    dots.style.animation = 'pinShake 0.4s ease';
    // Lock after 5 attempts
    if (_pinAttempts >= 5) {
      _pinLockUntil = Date.now() + 30000;
      _pinAttempts = 0;
      document.getElementById('pin-error').textContent = 'Too many attempts. Wait 30s';
    }
  }
}

// Shake animation
const pinStyle = document.createElement('style');
pinStyle.textContent = `@keyframes pinShake {
  0%,100%{transform:translateX(0)} 20%{transform:translateX(-8px)} 40%{transform:translateX(8px)} 60%{transform:translateX(-6px)} 80%{transform:translateX(6px)}
}`;
document.head.appendChild(pinStyle);

// ‚îÄ‚îÄ‚îÄ INIT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
loadPersistedData();
render();
checkInstallPrompt();
initPinLock();
// Delay Firebase init slightly to ensure SDK scripts have loaded
setTimeout(initFirebase, 500);
</script>
</body>
</html>